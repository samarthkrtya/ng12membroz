<!-- <div class="loading" *ngIf="disableBtn">Loading&#8230;</div> -->

<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xl-12">
                <div class="d-flex mt-3" id="headercustom">
                    <h3 class="card-title flex-grow-1 align-self-center m-0">{{getLang('calendar','Calendar')}}</h3>
                    <div >
                        <button id="addAppointment" type="button" class="btn btn-primary" (click)="addAppointment()">
                            <i class="material-icons">add</i>{{getLang('addappointment','Add Appointment')}} 
                        </button>
                        <button id="myModalAppointmentBtn" type="button" class="btn btn-primary d-none" data-toggle="modal" data-target="#myModalAppointment">
                            <i class="material-icons">add</i>{{getLang('addappointment','Add Appointment')}} 
                        </button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <ng-container *ngIf="serviceLists && serviceLists.length > 0; else emtyTmp ">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="d-md-flex mb-3" id="labellists">
                                        <div class="flex-md-grow-1">

                                            <div class="mb-md-0 mb-3">
                                                <mat-button-toggle-group [disabled]="disabled" [appearance]="appearance">
                                                    <mat-button-toggle (click)="action('staff')" value="1" checked="true">{{getLang('staff','Staff')}}</mat-button-toggle>
                                                    <mat-button-toggle (click)="action('service')" value="2">{{getLang('service','Service')}}</mat-button-toggle>
                                                </mat-button-toggle-group>
                                            </div>
                                        </div>
                                        <div >

                                        <div class="ts-blue-box ts-text-blue mb-1">
                                            {{getLang('requested','Requested')}}
                                        </div>

                                        <div class="ts-pink-box ts-text-pink btn-sm mb-1 ml-1 ml-lg-2">
                                            {{getLang('confirmed','Confirmed')}}
                                        </div>

                                        <div class="ts-green-box ts-text-green btn-sm mb-1 ml-1 ml-lg-2">
                                            {{getLang('checkin','Check-In')}}
                                        </div>

                                        <div class="attend-text-green attend-working-box mb-1 ml-1 ml-lg-2">
                                            {{getLang('checkout','Check Out')}}
                                        </div>

                                        <div class="attend-text-orange attend-holiday-box mb-1 ml-1 ml-lg-2">
                                            {{getLang('noshow','No Show')}}
                                        </div>

                                        </div>
                                    </div>
                                    <div class="row d-flex justify-content-end mb-1" id="functionlists">



                                        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6">
                                            <mat-form-field>
                                                <mat-label>Date</mat-label>
                                                <input 
                                                    matInput 
                                                    [matDatepicker]="picker" 
                                                    [(ngModel)]="date" 
                                                    (dateChange)="dateChange(date)"
                                                    [matDatepickerFilter]="myFilter">
                                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                <mat-datepicker #picker></mat-datepicker>
                                            </mat-form-field>
                                        </div>

                                        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6">
                                            <form [formGroup]="statusFormGroup">
                                                <mat-form-field >
                                                    <mat-select placeholder="Status" name="status" multiple formControlName="status">
                                                        <app-mat-option-select-all></app-mat-option-select-all>
                                                        <mat-option *ngFor="let item of status" [value]="item.id"> {{item.name}} </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </form>
                                        </div>


                                        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6">
                                            <form [formGroup]="staffFormGroup">
                                                <mat-form-field >
                                                    <mat-select placeholder="Staff" name="staff" multiple formControlName="staff">
                                                        <app-mat-option-select-all></app-mat-option-select-all>
                                                        <mat-option *ngFor="let item of staffLists" [value]="item._id"> {{item.fullname}} </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </form>
                                        </div>

                                        <div class="col-xl-2 col-lg-4 col-md-4 col-sm-6">
                                            <form [formGroup]="serviceFormGroup">
                                                <mat-form-field >
                                                    <mat-select placeholder="Service" name="service" multiple formControlName="service">
                                                        <app-mat-option-select-all></app-mat-option-select-all>
                                                        <mat-option *ngFor="let item of serviceLists"  [value]="item._id"> {{item.title}} </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div fxLayout="row" *ngIf="!calendarVisibility" fxLayoutAlign="space-around center" style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
                                                <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
                                            </div>
                                            <div>
                                                <full-calendar 
                                                    *ngIf="calendarVisibility" 
                                                    [options]="calendarOptions">
                                                </full-calendar>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #emtyTmp>

                            <ng-container *ngIf="!isLoadingInit">
                                <h3 class="text-center"> No Service available ! </h3>
                                <div class="d-flex justify-content-center">
                                <button 
                                    class="btn btn btn-outline-primary m-0 mr-2" 
                                    [routerLink]="['/pages/service-module/form']">
                                    <i class="material-icons" >add</i> Add Service to Complete the Setup
                                </button>
                                </div>
                            </ng-container>
                        </ng-template>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<button type="button" class="btn btn-info btn-lg d-none" >{{getLang('openmodal','Open Modal')}}</button>
<div id="myModalAppointment" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">{{getLang('appointment','Appointment')}}</h4>
                <button type="button" id="appointmentClose" (click)="cancel()" class="close " data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <app-appointment-booking
                    *ngIf="addAppointmnet"
                    #appintmentadd
                    [dataContent]="dataContent"
                    [services]="serviceLists"
                    [passondate]="date"
                    [selectInfo]="selectInfo"
                    type="multi"
                    [isEdit]="isEdit"
                    [isReschedule]="isReschedule"
                    [selectedAppointment]="this.selectedAppointment"
                    (onAppointmentData)="getSubmittedData($event)">
                </app-appointment-booking>
            </div>

        </div>
    </div>
</div>

<div class="modal" id="myModal" [style.display]="showModal ? 'block' : 'none'">
    <div class="modal-dialog ">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title"> {{selectedAppointment?.title}}  </h4>
                <button type="button" class="close" data-dismiss="modal" (click) = "hide()">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                 <div class="media mb-4" >
                    <img 
                        [src]="selectedAppointment?.memberprofilepic"
                        class="profile-avatar-img mr-3 rounded-circle" 
                        alt="">
                <div class="media-body">
                    <a class="btn btn-link btn-primary mat-raised-button m-0" (click)="openprofile(this.selectedAppointment)" >
                        <span class="font-bold mb-1">{{this.selectedAppointment?.attendeename}}</span>                        
                        <span class="font-bold mb-1" *ngIf="this.selectedAppointment?.numbercount"> [ {{this.selectedAppointment?.numbercount}} ]</span>
                    </a>
                  
                    <div class="d-flex">
                        <div class="flex-grow-1" *ngIf="this.selectedAppointment?.capacity">Capacity: {{this.selectedAppointment?.capacity}}</div>
                        <div class="flex-grow-1">{{selectedAppointment?.attendee?.property?.mobile}}</div>
                        <div class="text-gray"><small>Booked on {{selectedAppointment?.createdAt | date: 'MMM d, y'}}</small></div>
                    </div>
                </div>
                </div> 
                <ul class="list-unstyled"  *ngIf="this.selectedAppointment">

                     <li class="media mb-3"><mat-icon class="mat-icon material-icons mr-2">schedule</mat-icon>
                        <div class="media-body">
                            <div> {{selectedAppointment?.timeslot?.starttime}} - {{selectedAppointment?.timeslot?.endtime}} </div>
                            <div class="text-gray"><small>{{this.date | date: 'EEEE, MMMM d'}}</small></div>
                        </div>
                    </li>

                    <li class="media mb-3">
                        <div class="media-body">
                            <div class="font-bold mb-1"> {{selectedAppointment?.host?.fullname}}</div>
                            <div class="text-gray"><small> Status: {{selectedAppointment?.status}}</small></div>
                        </div>
                    </li>  

                    <li class="mb-3" *ngIf="this.selectedAppointment.status !== 'checkout' && !this.selectedAppointment.packageid">
                        <button class="btn btn-link-gray m-0 p-0" (click)="edit()">
                            <mat-icon class="mat-icon material-icons font-24 mr-1" >edit</mat-icon>
                            {{getLang('edit','Edit')}}
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.billid">
                        <button 
                            class="btn btn-link-gray m-0 p-0" 
                            (click)="viewBill(this.selectedAppointment?.billid)">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">feed</mat-icon>
                           {{getLang('viewbill','View Bill')}} 
                        </button>
                    </li>
                    
                    <li class="mb-3" *ngIf="this.selectedAppointment.status == 'checkout' && !this.selectedAppointment.billid">
                        <button 
                            [routerLink]="['/pages/appointment-module/frontdesk/' + this.selectedAppointment._id]"
                            class="btn btn-link-gray m-0 p-0" >
                            <mat-icon class="mat-icon material-icons font-24 mr-1">feed</mat-icon>
                           {{getLang('viewbill','View Bill')}} 
                        </button>
                    </li>

                    <li 
                        class="mb-3" 
                        *ngIf="this.selectedAppointment.status == 'requested'">
                        <button class="btn btn-link-gray m-0 p-0" (click)="appointmentStatus('confirmed')">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">done</mat-icon>
                            {{getLang('confirmed','Confirmed')}} 
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="checkStatus(this.selectedAppointment.status) && checkOnlineMeet(this.selectedAppointment) && isAdmin(this.selectedAppointment)">
                        <button class="btn btn-link-gray m-0 p-0" (click)="checkout('checkout')">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">shopping_cart</mat-icon>
                            {{getLang('generatebillandcheckout','Generate Bill & Checkout')}}  
                        </button>
                    </li>
                    
                    <li class="mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.status && this.selectedAppointment.status !== 'checkinguest' && this.selectedAppointment.status !== 'checkout'  && !this.selectedAppointment.packageid">
                        <button class="btn btn-link-gray m-0 p-0" (click)="reschedule()">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">schedule</mat-icon>
                            {{getLang('reschedule','Reschedule')}} 
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="!checkOnlineMeet(this.selectedAppointment)">
                        <button class="btn btn-link-gray m-0 p-0" (click)="redirect(this.selectedAppointment)">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">timer</mat-icon>
                            {{getLang('startnow','Start Now')}} 
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.status && this.selectedAppointment.status !== 'cancel' && this.selectedAppointment.status !== 'checkout' && this.selectedAppointment.status !== 'checkinguest' && (!this.selectedAppointment.billid)">
                        <button class="btn btn-link-gray m-0 p-0"  (click)="CancelAppointment()" data-toggle="modal" data-target="#myModalCancelAppointment">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">clear</mat-icon>
                            {{getLang('cancel','Cancel')}} 
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.status && this.selectedAppointment.status !== 'noshow'  && this.selectedAppointment.status !== 'checkinguest'  && this.selectedAppointment.status !== 'checkout'">
                        <button class="btn btn-link-gray m-0 p-0" (click)="appointmentStatus('noshow')">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">visibility_off</mat-icon>
                            {{getLang('noshow','No Show')}}
                        </button>
                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment.status !== 'checkout' && this.selectedAppointment.status !== 'checkinguest'&& this.selectedAppointment.status !== 'cancel' && this.selectedAppointment.status !== 'noshow'">
                        <button class="btn btn-link-gray m-0 p-0" (click)="appointmentStatus('checkinguest')">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">person</mat-icon>
                            {{getLang('checkinguest','Check-in Guest')}}
                        </button>
                    </li>

                    <li class="mb-3">
                        
                        <button class="btn btn-link-gray m-0 p-0" (click)="addtoGroup()" *ngIf="this.groupLists && this.groupLists.length == 0">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">groups</mat-icon>
                            {{getLang('addtogroup','Add to Group')}}
                        </button>

                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" class="btn btn-link-gray m-0 p-0" *ngIf="this.groupLists && this.groupLists.length > 0">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">groups</mat-icon>
                            {{getLang('addtogroup','Add to Group')}}
                        </button>

                        <mat-menu #menu="matMenu">
                            
                            <button mat-menu-item (click)="addtoGroup()">
                                <mat-icon class="mat-icon material-icons font-24 mr-1">add</mat-icon>
                                <span>New Group</span>
                            </button>

                            <button mat-menu-item (click)="groupAdding(item)" *ngFor="let item of groupLists">
                                <span >{{item.title}}</span>
                            </button>

                        </mat-menu>

                        <div class="media-body" *ngIf="this.selectedAppointment && this.selectedAppointment.property && this.selectedAppointment.property.group && this.selectedAppointment.property.group.id">
                            <div class="ml-32 font-14"> 
                                {{this.selectedAppointment.property.group.title}} <a class="btn btn-link btn-primary btn-just-icon mat-raised-button m-0" (click)="removeGroup()" ><i class="material-icons">delete</i></a>                               
                            </div>
                            
                        </div>

                    </li>

                    <li 
                        class="mb-3" 
                        *ngIf="this._loginUserBranch && this._loginUserBranch.paymentsetting && this._loginUserBranch.paymentsetting.allowdiposit && this._loginUserBranch.paymentsetting.allowdiposit == 'Yes' && this.selectedAppointment.status !== 'checkout' && this.selectedAppointment.status !== 'cancel'&& this.selectedAppointment.status !== 'noshow'  && this.selectedAppointment.status !== 'checkinguest' && (!this.selectedAppointment.billid)">
                        <button class="btn btn-link-gray m-0 p-0" (click)="takedeposit()">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">attach_money</mat-icon>
                            {{getLang('takedeposit','Take Deposit')}}
                        </button>

                        <div *ngIf="this.selectedAppointment && this.selectedAppointment.deposits && this.selectedAppointment.deposits.paidamount">                           
                                <div class="ml-32 font-14">{{this.selectedAppointment.deposits.paidamount | myCurrencyPipe}}</div>
                        </div>
                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment.status !== 'checkout' && this.selectedAppointment.status !== 'cancel'&& this.selectedAppointment.status !== 'noshow'  && this.selectedAppointment.status !== 'checkinguest' && (!this.selectedAppointment.billid)">
                        <button class="btn btn-link-gray m-0 p-0" (click)="addProduct()">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">shopping_cart</mat-icon>
                            {{getLang('addproduct','Add Product')}}
                        </button>

                        
                        <div class="media-body" *ngIf="this.selectedAppointment && this.selectedAppointment.productLists && this.selectedAppointment.productLists.length > 0">
                            <div class="ml-32 font-14" *ngFor="let item of this.selectedAppointment.productLists"> 
                                {{item.id.itemname}} (  {{item.quantity}} ) <a class="btn btn-link btn-primary btn-just-icon mat-raised-button m-0" (click)="removeProduct(item)"><i class="material-icons">delete</i></a>                                
                            </div>
                            
                        </div>

                    </li>

                    <li class="mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.billid">
                        <button class="btn btn-link-gray m-0 p-0" (click)="viewandprint(this.selectedAppointment?.billid)">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">visibility_on</mat-icon>
                            {{getLang('viewandprint','View & Print')}}
                        </button>
                    </li>

                    <!-- <li class="mb-3" >
                        <button class="btn btn-link-gray m-0 p-0">
                            <mat-icon class="mat-icon material-icons font-24 mr-1">print</mat-icon>
                            {{getLang('print','Print')}}
                        </button>
                    </li> -->

                    <li class="media mb-3" *ngIf="this.selectedAppointment && this.selectedAppointment.property && this.selectedAppointment.property.note && this.selectedAppointment.property.note !== ''">
                        <div class="media-body">
                            <div class="font-bold mb-1"> Notes: </div>
                            <div class="text-gray"><small> 
                                {{ (this.selectedAppointment.property.note.length > 250 ) ? (this.selectedAppointment.property.note | slice: 0 : 250) + '...' : (this.selectedAppointment.property.note) }}
                            </small></div>
                        </div>
                    </li>
                </ul>
            </div>

            
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal" (click) = "hide()">{{getLang('close','Close')}}</button>
            </div> -->

        </div>
    </div>
</div>

<!-- Modal -->
<div id="myModalCancelAppointment" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cancel Appointment</h4>
                <button type="button" class="close" id="cancelAppointmentCloseBtn" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <p> Are you Sure that you would like to cancel the following appointment </p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="text-gray"> {{this.attendee}} </div>
                            <div class="text-gray"> {{selectedAppointment?.title}} </div>
                            <div class="text-gray">{{selectedAppointment?.timeslot?.starttime}} - {{selectedAppointment?.timeslot?.endtime}} </div>
                        </div>
                        <div class="col-md-6"> 
                             
                            <mat-form-field appearance="fill">
                                <mat-label>Cancallation Reason <code> * </code> </mat-label>
                                <mat-select [(ngModel)]="cancallationreason">
                                    <mat-option value="">Select Reason</mat-option>
                                    <mat-option *ngFor="let reason of cancellationReasonLists" [value]="reason.code">
                                    {{reason.name}}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field> 
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-sm-6 text-left">
                            <button 
                                data-dismiss="modal"
                                class="btn btn-default" 
                                type="button">
                                <i class="material-icons">close</i> {{getLang('donotcancel', 'Do Not Cancel')}}
                            </button>
                        
                        </div>
                        <div class="col-sm-6 text-right">
                            <button 
                                (click)="cancelAppointmentSubmit()"
                                class="btn btn-primary ml-2" 
                                type="button" >
                                <i class="material-icons">save</i> {{getLang('earlycancel', 'Early Cancel')}}
                            </button>
                        </div>
    
                    </div>
                    
                </div>
              </div>
            <div class="modal-footer">
                
                
            </div>

        </div>
    </div>
</div>



<!-- Trigger the modal with a button -->
<button type="button" id="addProductBtn" class="btn btn-info btn-lg d-none" data-toggle="modal" data-target="#myModalAddProduct">Open Modal</button>

<!-- Modal -->
<div id="myModalAddProduct" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> {{selectedAppointment?.title}}  </h4>
                <button type="button" class="close" id="addproductclose" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="media mb-4">
                    <img
                        [src]="selectedAppointment?.memberprofilepic"
                        class="profile-avatar-img mr-3 rounded-circle"
                        alt="">
                    <div class="media-body">
                        <a class="btn btn-link btn-primary mat-raised-button" (click)="openprofile(this.selectedAppointment)" >
                            <span class="font-bold mb-1">{{this.selectedAppointment?.attendeename}}</span>
                            <span class="font-bold mb-1" *ngIf="this.selectedAppointment?.numbercount"> [ {{this.selectedAppointment?.numbercount}} ]</span>
                        </a>
                        <div class="d-flex">
                            <div class="flex-grow-1"> {{selectedAppointment?.attendee?.property?.mobile}}</div>
                            <div class="text-gray"><small>Booked on {{selectedAppointment?.createdAt | date: 'MMM d, y'}}</small></div>
                        </div>
                    </div>
                </div>

                <ul class="list-unstyled"  *ngIf="this.selectedAppointment">

                    <li class="media mb-3"><mat-icon class="mat-icon material-icons mr-2">schedule</mat-icon>
                        <div class="media-body">
                            <div> {{selectedAppointment?.timeslot?.starttime}} - {{selectedAppointment?.timeslot?.endtime}} </div>
                            <div class="text-gray"><small>{{this.date | date: 'EEEE, MMMM d'}}</small></div>
                        </div>
                    </li>

                    <li class="media mb-3">
                        <div class="media-body">
                            <div class="font-bold mb-1"> {{selectedAppointment?.host?.fullname}}</div>
                            <div class="text-gray"><small> Status: {{selectedAppointment?.status}}</small></div>
                        </div>
                    </li>

                </ul>

                <form 
                    [formGroup]="form" 
                    novalidate 
                    (ngSubmit)="onPorductSubmit(form.value, form.valid)"
                    class="form-horizontal">

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                <div class="col-sm-9">
                                    <label class="col-form-label">
                                        {{getLang('product', 'Product')}}
                                        <span class="text-danger">*</span>
                                    </label>

                                    <mat-form-field class="example-full-width">
                                        <input 
                                            required
                                            type="text"
                                            aria-label="Number"
                                            matInput
                                            formControlName="product"
                                            [matAutocomplete]="auto">

                                        <mat-autocomplete 
                                            #auto="matAutocomplete"
                                            [displayWith]="productdisplayFn">

                                            <mat-option *ngIf="productisLoadingBox" class="is-loading">
                                                <mat-spinner diameter="50"></mat-spinner>
                                            </mat-option>   

                                            <mat-option 
                                                *ngFor="let option of productFilteredOptions | async" 
                                                [value]="option">
                                                {{option?.itemname}}
                                            </mat-option>

                                        </mat-autocomplete>
                                    </mat-form-field>


                                    <div 
                                        [hidden]="form.get('product').valid || (form.get('product').pristine && !submitted)"
                                        class="text-danger">
                                        <small *ngIf="form.get('product').hasError('required')" class="error-label">
                                            {{getLang('productisrequired', 'Product is Required')}}
                                        </small>
                                    </div>

                                </div>

                                <div class="col-sm-3">
                                    <label class="col-form-label">
                                        {{getLang('quantity', 'Quantity')}}
                                        <span class="text-danger">*</span>
                                    </label>

                                    <mat-form-field class="example-full-width">
                                        <input 
                                            type="number"
                                            matInput 
                                            min="0" 
                                            max="100"
                                            formControlName="productquantity">
                                      </mat-form-field>


                                    <div 
                                        [hidden]="form.get('productquantity').valid || (form.get('productquantity').pristine && !submitted)"
                                        class="text-danger">
                                        <small *ngIf="form.get('productquantity').hasError('required')" class="error-label">
                                            {{getLang('productquantityisrequired', 'productquantity is Required')}}
                                        </small>
                                    </div>

                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
            
                        <div class="col-sm-12 text-right">

                            <button 
                                data-dismiss="modal"
                                class="btn btn-default" 
                                type="button" [disabled]="disableBtn">
                                <i class="material-icons">close</i> 
                                {{getLang('cancel', 'Cancel')}}
                            </button>

                            <button 
                                id="submit"
                                class="btn btn-primary ml-2" 
                                type="submit" [disabled]="disableBtn" >
                                <i class="material-icons">save</i> 
                                {{getLang('save', 'Save')}}
                            </button>

                        </div>
                            
                    </div>

                </form>


            </div>
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
        </div>

    </div>
</div>


<!-- Trigger the modal with a button -->
<button 
    type="button" 
    id="takeDipositeBtn" 
    class="btn btn-info btn-lg d-none" 
    data-toggle="modal" 
    data-target="#myModalTakeDiposite">
    Open Modal
</button>

<!-- Modal -->
<div id="myModalTakeDiposite" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">

                <h4 class="modal-title"> {{selectedAppointment?.title}}  </h4>
                <button type="button" class="close" id="takedipositeclose" data-dismiss="modal">&times;</button>
                
            </div>
            <div class="modal-body">

                <div class="media mb-4" >
                    <img 
                        [src]="selectedAppointment?.memberprofilepic"
                        class="profile-avatar-img mr-3 rounded-circle" 
                        alt="">
                    <div class="media-body">
                        <a class="flex-grow-1" (click)="openprofile(this.selectedAppointment)" >
                            <span class="font-bold mb-1">{{this.selectedAppointment?.attendeename}}</span>
                            <span class="font-bold mb-1" *ngIf="this.selectedAppointment?.numbercount"> [ {{this.selectedAppointment?.numbercount}} ]</span>
                        </a>
                        <div class="d-flex">
                            <div class="flex-grow-1"> {{selectedAppointment?.attendee?.property?.mobile}}</div>
                            <div class="text-gray"><small>Booked on {{selectedAppointment?.createdAt | date: 'MMM d, y'}}</small></div>
                        </div>
                    </div>

                </div>

                <ul class="list-unstyled"  *ngIf="this.selectedAppointment">

                    <li class="media mb-3"><mat-icon class="mat-icon material-icons mr-2">schedule</mat-icon>
                        <div class="media-body">
                            <div> {{selectedAppointment?.timeslot?.starttime}} - {{selectedAppointment?.timeslot?.endtime}} </div>
                            <div class="text-gray"><small>{{this.date | date: 'EEEE, MMMM d'}}</small></div>
                        </div>
                    </li>

                    <li class="media mb-3">
                        <div class="media-body">
                            <div class="font-bold mb-1"> {{selectedAppointment?.host?.fullname}}</div>
                            <div class="text-gray"><small> Status: {{selectedAppointment?.status}}</small></div>
                        </div>
                    </li>

                </ul>

                <form 
                    [formGroup]="paymentForm" 
                    novalidate 
                    (ngSubmit)="onPaymentSubmit(paymentForm.value, paymentForm.valid)"
                    class="form-horizontal">

                    <div class="row">

                        <div class="col-sm-6">

                            <label class="col-form-label">
                                {{getLang('depositamount', 'Deposit Amount')}}
                                <span class="text-danger">*</span>
                            </label>

                            <mat-form-field class="example-full-width">
                                <input 
                                    matInput 
                                    type="number" 
                                    formControlName="paidamount">
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('paidamount').valid || (paymentForm.get('paidamount').pristine && !paymentSubmitted)"
                                class="text-danger">

                                <small *ngIf="paymentForm.get('paidamount').hasError('required')"
                                    class="error-label">
                                    {{getLang('paidamountreqrd', 'Deposit Amount is Required')}}
                                </small>

                                <small *ngIf="paymentForm.get('paidamount').hasError('min')"
                                    class="error-label">
                                    {{getLang('paidamountreqrd', 'Deposit Amount is invalid')}}
                                </small>                                                
                            </div>
                        </div>

                        <div class="col-sm-12">

                            <label class="col-form-label">
                                {{getLang('modeofpayment', 'Mode of Payment')}}
                                <span class="text-danger">*</span>
                            </label>

                            <dynamic-autocomplete 
                                *ngIf="mode_fields.visible"
                                [formControlName]="mode_fields.fieldname"
                                [setting]="mode_fields"
                                (inputModelChange)="inputModelChangeValue($event)"
                                [dbvalue]="mode_fields.dbvalue">
                            </dynamic-autocomplete>

                            <div [hidden]="paymentForm.get('mode').valid || (paymentForm.get('mode').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('mode').hasError('required')" class="error-label">
                                    {{getLang('modeisrequired', 'Mode is Required')}}
                                </small> 
                            </div>
                        </div>

                        <div class="col-sm-6">
                            
                            <label class="col-form-label">
                                {{getLang('date', 'Date')}}
                                <span class="text-danger">*</span>
                            </label>

                            <mat-form-field>

                                <input 
                                    matInput 
                                    [matDatepicker]="picker2" 
                                    formControlName="paymentdate">

                                <mat-datepicker-toggle matSuffix [for]="picker2">
                                </mat-datepicker-toggle>
                                <mat-datepicker #picker2 color="primary"></mat-datepicker>
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('paymentdate').valid || (paymentForm.get('paymentdate').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('paymentdate').hasError('required')"
                                    class="error-label">
                                    {{getLang('dateisrequired', 'Date is Required')}}
                                </small>
                            </div>

                        </div>

                        <!-- <div class="col-sm-6" *ngIf="_receiptnumberVisibility">

                            <label class="col-form-label">
                                {{getLang('receiptnumber', 'Receipt Number')}}
                            </label>

                            <mat-form-field class="example-full-width">
                                <input 
                                    matInput 
                                    formControlName="receiptnumber" 
                                    name="receiptnumber">
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('receiptnumber').valid || (paymentForm.get('receiptnumber').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('receiptnumber').hasError('required')"
                                    class="error-label">
                                    {{getLang('receiptnumberisrequired', 'Receipt Number is Required')}}
                                </small>
                            </div>

                        </div> -->

                        <div class="col-sm-6" *ngIf="_bankDetailsVisbility">
                            
                            <label class="col-form-label">
                                {{getLang('chqnumber', 'Cheque Number')}}
                                <span class="text-danger">*</span>
                            </label>

                            <mat-form-field class="example-full-width">
                                <input 
                                    matInput 
                                    formControlName="chqnumber" 
                                    name="chqnumber">
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('chqnumber').valid || (paymentForm.get('chqnumber').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('chqnumber').hasError('required')"
                                    class="error-label">
                                    {{getLang('chqnumberisrequired', 'Cheque Number is Required')}}
                                </small>
                            </div>
                        </div>

                        <div class="col-sm-6" *ngIf="_bankDetailsVisbility || _cardDetailsVisbility">
                            
                            <label class="col-form-label">
                                {{getLang('bankname', 'Bank Name')}}
                                <span class="text-danger">*</span>
                            </label>

                            <dynamic-autocomplete 
                                *ngIf="bankname_fields.visible"
                                [formControlName]="bankname_fields.fieldname"
                                [setting]="bankname_fields"
                                [dbvalue]="bankname_fields.dbvalue">
                            </dynamic-autocomplete>

                            <div [hidden]="paymentForm.get('bankname').valid || (paymentForm.get('bankname').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('bankname').hasError('required')"
                                    class="error-label">
                                    {{getLang('banknameisrequired', 'Bank Name is Required')}}
                                </small> 
                            </div>
                        </div>

                        <div class="col-sm-6" *ngIf="_bankDetailsVisbility">

                            <label class="col-form-label">
                                {{getLang('chqdate', 'Cheque Date')}}
                            </label>

                            <mat-form-field>
                                <input matInput [matDatepicker]="picker3" formControlName="chqdate">
                                <mat-datepicker-toggle matSuffix [for]="picker3">
                                </mat-datepicker-toggle>
                                <mat-datepicker #picker3 color="primary"></mat-datepicker>
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('chqdate').valid || (paymentForm.get('chqdate').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('chqdate').hasError('required')"
                                    class="error-label">
                                    {{getLang('chqdateisrequired', 'Cheque Date is Required')}}
                                </small>
                            </div>
                        </div>

                        <div class="col-sm-6" *ngIf="_bankDetailsVisbility">

                            <label class="col-form-label">
                                {{getLang('chqstatus', 'Cheque Status')}}
                            </label>

                            <dynamic-autocomplete 
                                *ngIf="chequestatus_fields.visible"
                                [formControlName]="chequestatus_fields.fieldname"
                                [setting]="chequestatus_fields"
                                [dbvalue]="chequestatus_fields.dbvalue">
                            </dynamic-autocomplete>

                            <div [hidden]="paymentForm.get('chqstatus').valid || (paymentForm.get('chqstatus').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('chqstatus').hasError('required')"
                                    class="error-label">
                                    {{getLang('chqstatusisrequired', 'Cheque Status is Required')}}
                                </small>
                               
                            </div>
                        </div>

                        <div class="col-sm-6" *ngIf="_cardDetailsVisbility">

                            <label class="col-form-label">
                                {{getLang('cardnumber', 'Card Number(Last 4 digits)')}}
                            </label>

                            <mat-form-field class="example-full-width">
                                <input 
                                    matInput 
                                    formControlName="cardnumber" 
                                    name="cardnumber">
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('cardnumber').valid || (paymentForm.get('cardnumber').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('cardnumber').hasError('required')"
                                    class="error-label">
                                    {{getLang('cardnumberisrequired', 'Card Number is Required')}}
                                </small>
                            </div>
                        </div>

                        <div class="col-sm-6" *ngIf="_cardDetailsVisbility">
                            
                            <label class="col-form-label">
                                {{getLang('tidnumber', 'TID Number')}}
                            </label>

                            <mat-form-field class="example-full-width">
                                <input 
                                    matInput 
                                    formControlName="tidnumber" 
                                    name="tidnumber">
                            </mat-form-field>

                            <div [hidden]="paymentForm.get('tidnumber').valid || (paymentForm.get('tidnumber').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('tidnumber').hasError('required')"
                                    class="error-label">
                                    {{getLang('tidnumberisrequired', 'TID Number is Required')}}
                                </small>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <label class="col-form-label">
                                {{getLang('receivedby', 'Received By')}}
                            </label>

                            <dynamic-autocomplete 
                                *ngIf="paymentreceivedby_fields.visible"
                                [formControlName]="paymentreceivedby_fields.fieldname"
                                [setting]="paymentreceivedby_fields"
                                [dbvalue]="paymentreceivedby_fields.modelValue">
                            </dynamic-autocomplete>

                            <div [hidden]="paymentForm.get('paymentreceivedby').valid || (paymentForm.get('paymentreceivedby').pristine && !paymentSubmitted)"
                                class="text-danger">
                                <small *ngIf="paymentForm.get('paymentreceivedby').hasError('required')"
                                    class="error-label">
                                    {{getLang('paymentreceivedbyisrequired', 'Receivedby is Required')}}
                                </small>
                               
                            </div>
                        </div>

                        

                    </div>

                    <div class="row mt-3">
            
                        <div class="col-sm-12 text-right">

                            <button 
                                data-dismiss="modal"
                                class="btn btn-default" 
                                type="button" 
                                [disabled]="disableBtn">
                                <i class="material-icons">close</i> 
                                {{getLang('cancel', 'Cancel')}}
                            </button>

                            <button 
                                id="submit"
                                class="btn btn-primary ml-2" 
                                type="submit"
                                [disabled]="disableBtn">
                                <i class="material-icons">save</i> 
                                {{getLang('save', 'Save')}}
                            </button>

                        </div>
                            
                    </div>

                </form>

            </div>
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
        </div>

    </div>
</div>



<!-- Trigger the modal with a button -->
<button type="button" id="addGroupBtn" class="btn btn-info btn-lg d-none" data-toggle="modal" data-target="#myModalAddGroup">Open Modal</button>

<!-- Modal -->
<div id="myModalAddGroup" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            
            <div class="modal-header">
                <h4 class="modal-title"> {{selectedAppointment?.title}}  </h4>
                <button type="button" class="close" id="addGroupclose" data-dismiss="modal">&times;</button>
            </div>

            <div class="modal-body">
                
                <div class="media mb-4" >
                    <img 
                        [src]="selectedAppointment?.memberprofilepic"
                        class="profile-avatar-img mr-3 rounded-circle" 
                        alt="">
                    <div class="media-body">
                        <a class="flex-grow-1" (click)="openprofile(this.selectedAppointment)" >
                            <span class="font-bold mb-1">{{this.selectedAppointment?.attendeename}}</span>
                            <span class="font-bold mb-1" *ngIf="this.selectedAppointment?.numbercount"> [ {{this.selectedAppointment?.numbercount}} ]</span>
                        </a>
                        <div class="d-flex">
                            <div class="flex-grow-1"> {{selectedAppointment?.attendee?.property?.mobile}}</div>
                            <div class="text-gray"><small>Booked on {{selectedAppointment?.createdAt | date: 'MMM d, y'}}</small></div>
                        </div>
                    </div>

                </div>

                <ul class="list-unstyled"  *ngIf="this.selectedAppointment">

                    <li class="media mb-3"><mat-icon class="mat-icon material-icons mr-2">schedule</mat-icon>
                        <div class="media-body">
                            <div> {{selectedAppointment?.timeslot?.starttime}} - {{selectedAppointment?.timeslot?.endtime}} </div>
                            <div class="text-gray"><small>{{this.date | date: 'EEEE, MMMM d'}}</small></div>
                        </div>
                    </li>

                    <li class="media mb-3">
                        <div class="media-body">
                            <div class="font-bold mb-1"> {{selectedAppointment?.host?.fullname}}</div>
                            <div class="text-gray"><small> Status: {{selectedAppointment?.status}}</small></div>
                        </div>
                    </li>

                </ul>

                <form 
                    [formGroup]="groupForm" 
                    novalidate 
                    (ngSubmit)="onGroupSubmit(groupForm.value, groupForm.valid)"
                    class="form-horizontal">

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="row">
                                

                                <div class="col-sm-12">
                                    <label class="col-form-label">
                                        {{getLang('title', 'Title')}}
                                        <span class="text-danger">*</span>
                                    </label>

                                    <mat-form-field class="example-full-width">
                                        <input 
                                            matInput 
                                            formControlName="grouptitle">
                                      </mat-form-field>


                                    <div 
                                        [hidden]="groupForm.get('grouptitle').valid || (groupForm.get('grouptitle').pristine && !groupSubmitted)"
                                        class="text-danger">
                                        <small *ngIf="groupForm.get('grouptitle').hasError('required')" class="error-label">
                                            {{getLang('titleisrequired', 'Title is Required')}}
                                        </small>
                                    </div>

                                    
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
            
                        <div class="col-sm-12 text-right">

                            <button 
                                data-dismiss="modal"
                                class="btn btn-default" 
                                type="button">
                                <i class="material-icons">close</i> 
                                {{getLang('cancel', 'Cancel')}}
                            </button>

                            <button 
                                id="submit"
                                class="btn btn-primary ml-2" 
                                type="submit">
                                <i class="material-icons">save</i> 
                                {{getLang('save', 'Save')}}
                            </button>

                        </div>
                            
                    </div>

                </form>


            </div>

            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
            </div>
        </div>

    </div>
</div>