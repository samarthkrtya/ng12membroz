<div class="main-content">
  <div class="container-fluid">
    <div fxLayout="row" *ngIf="isLoadingData" fxLayoutAlign="space-around center"
      style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
      <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
    </div>

    <div class="row table-item-gutters" *ngIf="!isLoadingData">
      <div class="col-xl-4 col-lg-4 col-md-5 pr-md-0">
        <div class="card mb-0" *ngIf="!isPaymentMode">
          <div class="px-3">
            <mat-form-field class="example-full-width" appearance="standard">
              <input type="text" matInput [matAutocomplete]="auto" #trigger="matAutocompleteTrigger" [formControl]="memberControl"
                [placeholder]="getLang('searchcustomerormember', 'Search Customer or Member')"
                (dblclick)="trigger.openPanel()">
              <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn"
                (optionSelected)="inputModelChangeValue($event.option.value)">
                <mat-option *ngIf="customerisLoadingBox" class="is-loading">
                  <mat-spinner diameter="50"></mat-spinner>
                </mat-option>
                <ng-container *ngIf="!customerisLoadingBox && customerList.length > 0">
                  <mat-option *ngFor="let option of customerfilteredOptions | async" [value]="option">
                    {{option.nickname}}
                  </mat-option>
                </ng-container>
                <!-- <ng-container *ngIf="!customerisLoadingBox && customerList.length == 0">
                  <mat-option>
                    <span>{{getLang('norecord', 'No Record')}}</span>
                  </mat-option>
                </ng-container> -->
              </mat-autocomplete>
              <mat-icon matPrefix *ngIf="!searchMember" >search</mat-icon>
              <button matSuffix  class="btn btn-just-icon btn-link m-0 p-0"  [disabled]="disableBtn" (click)="clearMember()" *ngIf="searchMember && searchMember._id">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
            
          </div>
        </div>
        <div class="card pos-itembill-card mb-0">
          <div class="d-flex customer-name-p ">
            <div id="memberid" class="flex-grow-1 font-weight-bold">
              <ng-container *ngIf="searchMember" >
                <div>{{searchMember?.fullname}} {{searchMember?.membernumber ? ' | ' + searchMember?.membernumber : ''}}
                </div>
                <div>{{searchMember?.primaryemail}}</div>
                <div>{{searchMember?.mobile}}</div>
              </ng-container>
            </div>
            <div>
              <!-- <button
                    mat-raised-button
                    type="button"
                    class="btn btn-link btn-primary btn-just-icon edit" *ngIf="!canEditCustomer && !isPaymentMode" (click)="canEditCustomer = !canEditCustomer;">
                    <i class="material-icons">edit</i>
                </button> -->
              <button type="button" class="btn btn-primary text-nowrap" data-toggle="modal" data-target="#customerModal"
                *ngIf="!isPaymentMode && !isDisableEdit"> <i class="material-icons">person_add_alt</i> {{getLang('newcustomer', 'New')}}
              </button>
            </div>
          </div>
          <div class="loader" *ngIf="isLoadingCart">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>
          </div>
          <div class="table-responsive">
            <table class="table table-membroz table-pos">
              <thead>
                <tr>
                  <th>{{getLang('product', 'Product')}}</th>
                  <th class="text-center" colspan="2">{{getLang('qty', 'Qty')}}</th>
                  <th class="text-right">{{getLang('price', 'Price')}}</th>
                  
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let items of cartItemList">
                  <td>{{items?.item?.itemname}} {{ items.itemnumber ? "(#" + items?.itemnumber + ")": '' }} </td>
                  <td class="text-center text-nowrap" colspan="2">
                    <!-- <a href="javascript:void(0)" [class.disabled]="items.quantity == 1" (click)="onSubtrct(items.item)"
                      *ngIf="!isPaymentMode">
                      <img src="../../../../../assets/img/pos-minus-icon.svg" alt="" class="mr-2">
                    </a>
                    {{items.quantity}}
                    <a href="javascript:void(0)" (click)="onAdd(items.item)" *ngIf="!isPaymentMode">
                      <img class="ml-2" src="../../../../../assets/img/pos-plus-icon.svg" alt="">
                    </a> -->
                    <mat-form-field class="example-full-width mat-form-field-space-remove" style="width: 70px;">
                        <input type="number" matInput  [(ngModel)]="items.quantity" style="text-align: right;" [disabled]="isPaymentMode" (input)="onChangeQty($event.target.value ,items.item)" oninput="this.value = Math.abs(this.value)">
                    </mat-form-field>
                  </td>
                  <td class="text-right align-top">
                    <div>{{items?.item?.sale?.rate | myCurrencyPipe}} </div>
                    <div *ngIf="items?.discount">-{{items?.discount | myCurrencyPipe}}</div>
                    <div *ngIf="items?.coupondiscount">-{{items?.coupondiscount | myCurrencyPipe}}</div>
                    <div>
                      <a class="mr-2" href="javascript:void(0)" [class.disabled]="disableBtn" (click)="onRemove(items.item,items)"
                        *ngIf="!isPaymentMode">
                        <img src="../../../../../assets/img/pos-delete-icon.svg" alt="">
                      </a>
                      <a class="mr-2" href="javascript:void(0)" (click)="onEditPrd(items, true);checkCpn()" *ngIf="!isPaymentMode">
                        <img src="../../../../../assets/img/edit-gray-icon.svg" alt="">
                      </a>
                    </div>
                   </td>
                </tr>
                <tr *ngIf="cartItemList.length == 0">
                  <td colspan="4" >No Products</td>
                </tr>
              </tbody>
            </table>

            <table class="table table-membroz table-pos mb-0" *ngIf="packagecartList.length > 0">              
              <tbody>
                <tr>
                  <th colspan="4"> Packages </th>
                </tr>
                <ng-container *ngFor="let items of packagecartList">
                  <tr>
                    <td class="font-weight-600">{{items?.membershipname}}</td>
                    <td class="text-right"> {{items?.rate | myCurrencyPipe}} </td>
                  </tr> 
                  <ng-container  *ngIf="items.bookingids && items.bookingids.length > 0" >
                  <tr *ngFor="let item of items.bookingids">
                        <td width="108" style="padding-right: 0 !important;vertical-align: top;" >
                          <div class="attend-holiday-box min-width-108 text-center">                            
                             <div class="font-14 text-nowrap">{{item?.bookingid?.appointmentdate | date:'MMM d'  }}</div>
                             <div class="font-14 text-nowrap">{{item?.bookingid?.timeslot?.starttime }} - {{item?.bookingid?.timeslot?.endtime }}</div>
                          </div>
                        </td>
                        <td colspan="3" style="padding-right: 0 !important;vertical-align: top;">
                          <div>  {{item?.bookingid?.refid?.title}} 
                              <span class="ml-1 font-14 fc-today-button"
                               [ngClass]="{'ts-text-blue': item.bookingid?.status == 'requested',
                              'attend-text-green': item.bookingid?.status == 'confirmed',
                              'attend-text-red': item.bookingid?.status == 'cancel',
                              'pos-text-jambli': item.bookingid?.status == 'checkout',
                              'pricing-color-1': item.bookingid?.status == 'inwaiting',
                              'text-secondary': item.bookingid?.status == 'noshow'}">
                               {{item.bookingid?.status}}
                              </span>
                            </div>
                          <div>{{item.bookingid?.host?.fullname}}  </div>
                      </td>
                     
                  
                  </tr>
                </ng-container>
              </ng-container>
                
              </tbody>
            </table>

            <table class="table table-membroz table-pos" >

              <tbody>
                <ng-container *ngIf="servicecartList.length > 0">
                <th colspan="4">Appointments</th>
                <tr *ngFor="let item of servicecartList">
                  <td width="70" style="padding-right: 0 !important;vertical-align: top;" >
                    <div class="attend-holiday-box text-center">
                       <div class="font-weight-600">{{item?.duration}}m</div>
                       <div class="font-14">{{item?.timeslot?.starttime }}</div>
                    </div>
                  </td>

                  <td style="padding-right: 0 !important;vertical-align: top;">
                      <div class="font-weight-600"> {{item?.title}}
                          <span class="ml-1 font-weight-600 font-14 fc-today-button"
                           [ngClass]="{'ts-text-blue': item?.status == 'requested',
                          'attend-text-green': item?.status == 'confirmed',
                          'attend-text-red': item?.status == 'cancel',
                          'pos-text-jambli': item?.status == 'checkout',
                          'pricing-color-1': item?.status == 'inwaiting',
                          'text-secondary': item?.status == 'noshow'}">
                           {{item?.status}}
                          </span>
                        </div>
                      <div>{{item?.host?.fullname}}  </div>
                  </td>
                  <td colspan="2" class="text-right align-top">
                      <div>{{item?.cost | myCurrencyPipe}}</div>
                      <div *ngIf="item?.discount">-{{item?.discount | myCurrencyPipe}}</div>
                      <div *ngIf="item?.coupondiscount">-{{item?.coupondiscount | myCurrencyPipe}}</div>
                      <div>
                        <a href="javascript:void(0)" [class.disabled]="disableBtn" (click)="onRemoveService(item)"
                        *ngIf="!isPaymentMode"> <img src="../../../../../assets/img/pos-delete-icon.svg" alt=""> </a>
                      <span class="ml-2">
                        <a href="javascript:void(0)" [class.disabled]="disableBtn" data-toggle="modal"
                          (click)="onClickService(item.refid);checkCpn('service')" data-target="#serviceModal" *ngIf="!isPaymentMode"> <img
                            src="../../../../../assets/img/edit-gray-icon.svg" alt=""> </a>
                      </span>
                      </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="4">&nbsp;</td>
                </tr>
              </ng-container>

                <tr *ngIf="discount">
                  <td class="border-bottom" colspan="3">{{getLang('discount', 'Discount')}}</td>
                  <td class="text-right border-bottom">{{discount | myCurrencyPipe}} </td>
                </tr>
                <!-- <tr>
                  <td class="font-weight-bold border-bottom" colspan="3">{{getLang('subtotal', 'Subtotal')}}</td>
                  <td class="text-right font-weight-bold border-bottom">{{subtotal | myCurrencyPipe}}</td>
                </tr> -->
                <!-- <tr>
                  <td class="border-bottom" colspan="2">Tax Detail</td>
                  <td class="text-right border-bottom">
                    <table>
                      <tr *ngFor="let taxes of taxesList">
                        <td> {{taxes?.taxname}} </td>
                        <td> {{taxes?.amount | myCurrencyPipe}} </td>
                      </tr>
                    </table>
                  </td>

                </tr> -->

                <tr *ngIf="packagediscount">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('packagediscount', 'Package discount')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18">{{packagediscount | myCurrencyPipe}}
                  </td>
                </tr>
                <tr *ngIf="taxamount">
                  <td class="border-bottom" colspan="3">{{getLang('tax', 'Tax')}}</td>
                  <td class="text-right border-bottom">{{taxamount | myCurrencyPipe}}</td>
                </tr>
                <tr>
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('grandtotal', 'Grand Total')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18">{{grandtotal | myCurrencyPipe}}</td>
                </tr>

                <tr *ngIf="status && status != 'Unpaid'">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('paidamount', 'Paid Amount')}}</td>
                  <td
                  class="text-right font-weight-bold border-bottom font-18">{{paidamount | myCurrencyPipe}}</td>
                </tr>

                <tr  *ngIf="status && status != 'Unpaid'">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('balance', 'Balance')}}</td>
                  <td
                  class="text-right font-weight-bold border-bottom font-18">{{balance | myCurrencyPipe}}</td>
                </tr>

                <tr>
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('remainingiouamount',
                    'IOU Amount')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18" *ngIf="outstandingamount == 0">
                    {{outstandingamount | myCurrencyPipe}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18" *ngIf="outstandingamount > 0">
                    <a href="javascript:void(0)" (click)="checkIOUMode()" style="color: red;"> {{outstandingamount |
                      myCurrencyPipe}}</a>
                  </td>
                </tr>

                <tr *ngIf="visible && !isPaymentMode">
                  <td colspan="4">
                    <div class="p-1">
                    <app-dynamic-property-fields
                      [formid]="formObj._id"
                      [myForm]="billform"
                      [mySubmitted]="this.isSubmitted"
                      [bindIdData]="_propertyobjectModel">
                    </app-dynamic-property-fields>
                  </div>
                  </td>
                </tr>

              </tbody>
            </table>
          </div>

          <ng-container *ngIf="!isLoadingCart">
          <ng-container *ngIf="!_billModel.status || _billModel.status != 'Paid';else paidDisplay">
            <div class="customer-name-p" >
              <div class="row" *ngIf="!isPaymentMode">
                <div class="pr-0" [ngClass]="_billModel && _billModel._id ? 'col-4' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onNewBill()"
                    class="btn btn-primary btn-block">{{getLang('savebill', 'Save Bill')}}</button>
                </div>
                <div [ngClass]="_billModel && _billModel._id ? 'col-4 pr-0' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onCheckout()"
                    class="btn btn-success btn-block">{{getLang('checkout', 'Pay & Checkout')}}</button>
                </div>

                <div *ngIf="_billModel && _billModel._id" [ngClass]="_billModel && _billModel._id ? 'col-4' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onPrint(_billModel._id)"
                    class="btn btn-success btn-block">{{getLang('print', 'Print')}}</button>
                </div>
              </div>
              <ng-container *ngIf="isPaymentMode">
                <div class="row" *ngIf="status && status == 'Unpaid'">
                  <div class="col-12">
                    <button type="button" [disabled]="disableBtn" (click)="onMoreOption()"
                      class="btn btn-success btn-block">{{getLang('addmore', 'Edit Cart')}}</button>
                  </div>
                </div>
                <div class="row" *ngIf="_billModel && _billModel._id && status && status == 'Partial'">
                  <div class="col-md-12">
                      <!--display if done some payment  *ngIf="balance != 0 && balance != grandtotal"  -->
                        <button type="button" (click)="setNewPayment()"
                                class="btn btn-success btn-block">{{getLang('newpymn', 'New Payment')}}
                        </button>
                  </div>
                  <!-- (click)="onDelete()" -->
                </div>
            </ng-container>
            </div>
          </ng-container>
          <ng-template #paidDisplay>
            <div *ngIf="_billModel && _billModel._id" class="col-12">
              <button type="button" [disabled]="disableBtn" (click)="onPrint(_billModel._id)"
                class="btn btn-success btn-block">{{getLang('viewreciept', 'View Reciept')}}</button>
            </div>
          </ng-template>
        </ng-container>
        </div>
      </div>
      <div class="col-xl-8 col-lg-8 col-md-7">
        <ng-container *ngIf="!isPaymentMode;else templateMode">
          <div class="pr-md-0" [hidden]="isPaymentMode">
            <div class="row">
              <div class="col-xl-12">
                <mat-tab-group class="frontdesk-tab-card" [(selectedIndex)]="selectedIndexes"
                  (selectedTabChange)="onTabChanged($event)">
                  <mat-tab label="Front Desk">
                    <ng-template matTabContent>
                      <div class="card px-3 mt-0">
                        <div class="row align-items-center">
                          <div class="col-md-5 col-lg-6 col-xl-3">
                            <mat-form-field class="example-full-width">
                              <input matInput [(ngModel)]="selectedDate" [matDatepicker]="picker"
                                (dateChange)="onDateChanged()" placeholder="Appointment date"
                                [disabled]="isDisableEdit">
                              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                              <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-7 col-lg-6 col-xl-9 text-right">
                            <div>
                              <div class="ts-blue-box ts-text-blue mb-1 pointer"  
                              (click)="addStatus('requested')">
                                  {{getLang('requested','Requested')}} 
                              </div>
                
                              <div class="ts-pink-box ts-text-pink btn-sm mb-1 ml-1 ml-lg-2 pointer" (click)="addStatus('confirmed')">
                                  {{getLang('confirmed','Confirmed')}}
                              </div>
                 
                              <div class="attend-text-green attend-working-box mb-1 ml-1 ml-lg-2 pointer"  (click)="addStatus('checkout')">
                                  {{getLang('checkout','Check Out')}}
                              </div>
                
                              <!-- <div class="attend-text-red attend-absent-box mb-1 ml-1 ml-lg-2 pointer" [ngClass]="selectedStatus.includes('cancel') ? 'bg-red' : ''" (click)="addStatus('cancel')">
                                  {{getLang('cancel','Cancel')}}
                              </div> -->
                
                              <div class="attend-text-orange attend-holiday-box mb-1 ml-1 ml-lg-2 pointer"  (click)="addStatus('noshow')">
                                  {{getLang('noshow','No Show')}}
                              </div>

                              <div class="ts-green-box ts-text-green mb-1 ml-1 ml-lg-2 pointer" (click)="addStatus('checkinguest')">
                                {{getLang('checkin ',' Check-In')}}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="loader" *ngIf="isLoadings['appointment']">
                        <svg class="circular" viewBox="25 25 50 50">
                          <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2"
                            stroke-miterlimit="10" />
                        </svg>
                      </div>

                      <div class="row card-item-gutters mt-3">
                        <div class="col-xl-3 col-lg-3 col-md-4 col-sm-4 col-6 d-flex" *ngFor="let app of appintmentList;let i = index">
                             <div class="card w-100" style="border-radius: 10px !important;overflow: hidden;" [ngClass]="{'selected': app.selected}">
                              <div class="card-body p-2"
                              [ngClass]="{'bg-blue': app?.status == 'requested',
                              'bg-pink': app?.status == 'confirmed',
                              'bg-red': app?.status == 'cancel' ,
                              'bg-orange':  app?.status == 'noshow',
                              'bg-skyblue': app?.status == 'checkout',
                              'bg-yellow': app?.status == 'inwaiting',
                              'bg-green': app?.status == 'checkinguest'}"
                               (click)="onClickApp(app);checkCpn('service')" data-toggle="modal" data-target="#serviceModal">

                                <div class="flex-column">
                                  {{app?.refid?.title}} 
                                  <span class="img-add-product-delete d-none" *ngIf="app.viewCancel">
                                    <button mat-raised-button type="button" [disabled]="disableBtn"
                                      class="btn btn-just-icon btn-link" (click)="onRemoveApp(app)">
                                      <i class="material-icons font-18">close</i>
                                    </button>
                                  </span>
                                </div>
                                <div class="media mb-3">
                                  <img [src]="app?.attendee?.profilepic ? app?.attendee?.profilepic : '../assets/img/default-avatar.png'" class="profile-avatar-img mr-3 rounded-circle" alt="">
                                  <div class="media-body">
                                      <div class="font-bold mb-1">{{app?.attendee?.fullname}} </div>
                                      <div class="d-flex">
                                          <div class="flex-grow-1"> {{app?.attendee?.property?.mobile}}</div>
                                      </div>
                                  </div>
                                </div>
                                <ul class="list-unstyled">
                                  <li class="media mb-3"><mat-icon class="mat-icon material-icons mr-2">schedule</mat-icon>
                                      <div class="media-body">
                                          <div> {{app?.timeslot?.starttime}} - {{app?.timeslot?.endtime}} </div>
                                      </div>
                                  </li>
                                  <li class="media mb-3">
                                    <div class="media-body">
                                        <div class="font-bold mb-1"> {{app?.host?.fullname}}</div>
                                          <mat-icon *ngIf="app.islock" class='mat-icon material-icons font-16 mr-1 float-right'>lock</mat-icon>
                                          <mat-icon *ngIf="app.note" class='mat-icon material-icons font-16 mr-1 float-right'>comment</mat-icon>
                                          <mat-icon *ngIf="app.packages" class='mat-icon material-icons font-16 mr-1 float-right'>link</mat-icon>
                                    </div>
                                </li>
                                </ul>
                              </div>
                            </div>
                         </div>
                      </div>

                    </ng-template>
                  </mat-tab>
                

                  <mat-tab label="Service">
                    <div class="card px-3 mt-0">
                      <div class="row">
                        <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                          <mat-form-field class="example-full-width pt-0" appearance="standard">
                            <input matInput #gsearch placeholder="Search service" id="global_search_terms"
                              [(ngModel)]="searchService.value" (ngModelChange)="onSearchService()">
                            <span class="material-input"></span>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <ng-container *ngIf="serviceListGrp && serviceListGrp.length > 0;else srTmpl">
                    <mat-tab-group [(selectedIndex)]="searchService.index">
                      <mat-tab label="All">
                        <div class="row card-item-gutters mt-3">
                          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                            *ngFor="let item of serviceList">
                            <div class="card pos-menu-card w-100" data-toggle="modal" 
                               [ngClass]="{'selected': item.selected}" (click)="onClickServiceNew(item)"  >
                               
                               <img
                                [src]="item.gallery && item.gallery.length > 0 ?  item.gallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                class="card-img-top card-img-size" alt="">
                              <div class="card-body p-2">
                                <div class="card-item-title mb-1">{{item?.title}}</div>
                                <div class="card-item-price">{{(item?.charges) | myCurrencyPipe}}</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </mat-tab>
                      <ng-container *ngFor="let itemList of serviceListGrp">
                        <mat-tab [label]="itemList[0].categoryname">
                          <div class="row card-item-gutters mt-3">
                            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex" *ngFor="let item of itemList">
                              <div class="card pos-menu-card w-100" data-toggle="modal"
                                [ngClass]="{'selected': item.selected}" (click)="onClickServiceNew(item)">
                                  
                                <img
                                  [src]="item.gallery && item.gallery.length > 0 ?  item.gallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                  class="card-img-top card-img-size" alt="">
                                <div class="card-body p-2">
                                  <div class="card-item-title mb-1">{{item?.title}}</div>
                                  <div class="card-item-price">{{(item?.charges | myCurrencyPipe)}}</div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </mat-tab>
                      </ng-container>
                    </mat-tab-group>
                  </ng-container>
                  <ng-template #srTmpl>
                    <h3 class="text-center"> No Services available ! </h3>
                      <div class="d-flex justify-content-center">
                        <button class="btn btn btn-outline-primary m-0 mr-2" [routerLink]="['/pages/service-module/form']">
                            <i class="material-icons" >add</i> Add New Service
                        </button>
                    </div>
                  </ng-template>
                  </mat-tab>

                  <mat-tab label="Product">
                    <div class="card px-3 mt-0">
                      <div class="row">
                        <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                          <mat-form-field class="example-full-width pt-0" appearance="standard">
                            <input matInput #gsearch placeholder="Search item name or barcode" id="global_search_terms"
                              [(ngModel)]="searchBox.value" (ngModelChange)="onSearchItem()">
                            <span class="material-input"></span>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>

                    <ng-container *ngIf="billItemListGrp && billItemListGrp.length > 0;else prTmpl">
                      <mat-tab-group [(selectedIndex)]="searchBox.index">
                        <mat-tab label="All">
                          <div class="row card-item-gutters mt-3">
                            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                              *ngFor="let item of billItemList">
                              <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                <ng-container *ngIf="item.quantity && item.quantity > 0">
                                  <div class="box-item-selected">{{item?.quantity}}</div>
                                </ng-container>
                                <img
                                  [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                  class="card-img-top card-img-size" alt="">
                                <div class="card-body p-2">
                                  <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                  <div class="card-item-price">{{item?.sale?.rate  | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </mat-tab>
                        <ng-container *ngFor="let itemList of billItemListGrp">
                          <mat-tab [label]="itemList[0].category">
                            <div class="row card-item-gutters mt-3">
                              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex" *ngFor="let item of itemList">
                                <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                  [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                  <ng-container *ngIf="item.quantity && item.quantity > 0">
                                    <div class="box-item-selected">{{item?.quantity}}</div>
                                  </ng-container>
                                  <img
                                    [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                    class="card-img-top card-img-size" alt="">
                                  <div class="card-body p-2">
                                    <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                    <div class="card-item-price">{{item?.sale?.rate | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </mat-tab>
                        </ng-container>
                      </mat-tab-group>
                    </ng-container>
                    <ng-template #prTmpl>
                      <h3 class="text-center"> No Products available ! </h3>
                      <div class="d-flex justify-content-center">
                        <button class="btn btn btn-outline-primary m-0 mr-2" [routerLink]="['/pages/product-module/form']">
                            <i class="material-icons" >add</i> Add New Product
                        </button>
                      </div>
                    </ng-template>
                  </mat-tab>
   
                      <mat-tab label="Packages">
                        <ng-container *ngIf="packageList && packageList.length > 0;else prTmpl">
                        <div class="row card-item-gutters mt-3">
                          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                            *ngFor="let item of packageList">
                            <div class="card pos-menu-card w-100" [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                              <ng-container *ngIf="item.quantity && item.quantity > 0">
                                <div class="box-item-selected">{{item?.quantity}}</div>
                              </ng-container>
                              <img
                                [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                class="card-img-top card-img-size" alt="">
                              <div class="card-body p-2">
                                <div class="card-item-title mb-1">{{item?.membershipname}}</div>
                                <div class="card-item-price">{{item?.property?.cost  | myCurrencyPipe}} </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                      <ng-template #prTmpl>
                        <h3 class="text-center"> No Package available ! </h3>
                        <div class="d-flex justify-content-center">
                          <button class="btn btn btn-outline-primary m-0 mr-2" [routerLink]="['/pages/dynamic-dashboard']">
                              <i class="material-icons" >add</i> Add New Package
                          </button>
                        </div>
                      </ng-template>
                      </mat-tab>
                    
                      <mat-tab label="Giftcards">
                        <ng-container *ngIf="giftCardList && giftCardList.length > 0;else gcTmpl">
                           <div class="row card-item-gutters mt-3">
                              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                                *ngFor="let item of giftCardList">
                                <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                  [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                  <ng-container *ngIf="item.quantity && item.quantity > 0">
                                    <div class="box-item-selected">{{item?.quantity}}</div>
                                  </ng-container>
                                  <img
                                    [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                    class="card-img-top card-img-size" alt="">
                                  <div class="card-body p-2">
                                    <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                    <div class="card-item-price">{{item?.sale?.rate  | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                        </ng-container>
                        <ng-template #gcTmpl>
                          <h3 class="text-center"> No Gitcard available ! </h3>
                        </ng-template>
                      </mat-tab>



                      <mat-tab label="Giftcertificate">

                        <div class="card px-3 mt-0">
                          <div class="row">
                            <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                              <mat-form-field class="example-full-width pt-0" appearance="standard">
                                <input matInput #gsearch placeholder="Search item name or barcode" id="global_search_terms"
                                  [(ngModel)]="searchBox.value" (ngModelChange)="onSearchGCR()">
                                <span class="material-input"></span>
                              </mat-form-field>
                            </div>
                          </div>
                        </div>

                        <ng-container *ngIf="giftCertificateList && giftCertificateList.length > 0;else grcTmpl">
                            <div class="row card-item-gutters mt-3">
                              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                                *ngFor="let item of giftCertificateList">
                                <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                  [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                  <ng-container *ngIf="item.quantity && item.quantity > 0">
                                    <div class="box-item-selected">{{item?.quantity}}</div>
                                  </ng-container>
                                  <img
                                    [src]="item?.property?.thumbnail ? item?.property?.thumbnail : '../../../../../assets/img/image_placeholder.jpg'"
                                    class="card-img-top card-img-size" alt="">
                                  <div class="card-body p-2">
                                    <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                    <div class="card-item-price">{{item?.sale?.rate  | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                        </ng-container>
                        <ng-template #grcTmpl>
                          <h3 class="text-center"> No Gift Certificate available ! </h3>
                        </ng-template>
                      </mat-tab>
                </mat-tab-group>

              </div>
            </div>
          </div>
        </ng-container>
        <ng-template #templateMode>

          <app-bill-check-out *ngIf="!isIOUMode && !isLoadingCart &&  _billModel && _billModel._id" #billcheckout [billid]="_billModel._id" [billpayid]="billpayid" [formname]="'bill'" [payformname]="'billpayment'">
          </app-bill-check-out>

          <app-bill-iou-checkout *ngIf="isIOUMode && !isLoadingCart" [searchMember]="searchMember"
            [outstandingamount]="outstandingamount" (onMakePayment)="redirecttoURL($event)"
            (onBack)="onBackIOUMode($event)">
          </app-bill-iou-checkout>
       </ng-template>

      </div>
    </div>
  </div>
</div>




<div class="modal fade" id="customerModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form [formGroup]="form" (ngSubmit)="onSubmitProspect(form.value,form.valid)" novalidate>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ConfirmModalLabel"> {{getLang('newcustomer', 'New Customer')}} </h5>
          <button type="button" id="close" (click)="form.reset();" class="close" data-dismiss="modal"
            aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('firstname', 'First Name')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="firstname" type="text">
              </mat-form-field>
              <div [hidden]="form.get('firstname').valid || (form.get('firstname').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('firstname').hasError('required')" class="error-label">
                  {{getLang('firstnameisrequired', 'firstname is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('lastname', 'Last Name')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="lastname" type="text">
              </mat-form-field>
              <div [hidden]="form.get('lastname').valid || (form.get('lastname').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('lastname').hasError('required')" class="error-label">
                  {{getLang('lastnameisrequired', 'lastname is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('mobile', 'Mobile')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="mobile" type="number">
              </mat-form-field>
              <div [hidden]="form.get('mobile').valid || (form.get('mobile').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('mobile').hasError('required')" class="error-label">
                  {{getLang('mobileisrequired', 'Mobile is Required')}}
                </small>
                <small *ngIf="form.get('mobile').hasError('onlyvalidmobilenumber')" class="error-label">
                  {{getLang('validnumberisrequired', 'Valid Mobile is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('email', 'Email')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="primaryemail" type="text">
              </mat-form-field>
              <div [hidden]="form.get('primaryemail').valid || (form.get('primaryemail').pristine && !submitted)" class="text-danger">
                <small *ngIf="form.get('primaryemail').hasError('required')" class="error-label">
                  {{getLang('primaryemailisrequired', 'primaryemail is Required')}}
                </small>
                <small *ngIf="form.get('primaryemail').hasError('primaryemail')" class="error-label">
                  {{getLang('validprimaryemailisrequired', 'Valid Email is required')}}
                </small>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" [disabled]="disableBtn" data-dismiss="modal" (click)="form.reset()"
            class="btn btn-default">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}</button>
          <button type="submit" [disabled]="disableBtn" class="btn btn-primary ml-2">
            <i class="material-icons">save</i>
            {{getLang('save', 'Save')}}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="serviceModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
      <div fxLayout="row" *ngIf="loadingprd" fxLayoutAlign="space-around center"
              style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
              <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
      </div>
      <ng-container *ngIf="!loadingprd">
        <form [formGroup]="serviceForm" (ngSubmit)="onSubmitService(serviceForm.value,serviceForm.valid)" novalidate>
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ConfirmModalLabel"> {{serviceForm.get('title').value}}
              {{serviceForm.get('appointmentdate').value | date}}</h5>
            <button type="button" id="closeservice" (click)="closeService(selectedService)" class="close"
              data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('provider', 'Provider')}}
                  <span class="text-danger">*</span>
                </label>
                <mat-form-field class="example-full-width">
                  <input type="text" matInput formControlName="host" [matAutocomplete]="autopr">
                  <mat-autocomplete #autopr="matAutocomplete" [displayWith]="displayFnPr"
                    (optionSelected)="onChangeProvider($event.option.value, serviceForm.value)">
                    <ng-container *ngIf="providerList.length > 0">
                      <mat-option *ngFor="let option of providerfilteredOptions | async" [value]="option">
                        {{option.fullname}}
                      </mat-option>
                    </ng-container>
                    <ng-container *ngIf="providerList.length == 0">
                      <mat-option>
                        <span>No Record</span>
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>


                <div [hidden]="serviceForm.get('host').valid || (serviceForm.get('host').pristine && !s_submitted)"
                  class="text-danger">
                  <small *ngIf="serviceForm.get('host').hasError('required')" class="error-label">
                    {{getLang('providerisrequired', 'Provider is required !')}}
                  </small>
                </div>
              </div>

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('timeslot', 'Time Slot')}}
                  <span class="text-danger">*</span>
                </label>
                <div class="row" formGroupName="timeslot">
                  <div class="col-md-6">
                    <mat-form-field class="example-full-width">
                      <mat-select matInput formControlName="starttime"  (selectionChange)="chooseTimeslot($event.value)">
                        <mat-option *ngIf="timeisLoadingBox" class="is-loading">
                          <mat-spinner diameter="50"></mat-spinner>
                        </mat-option>
                        <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length > 0">
                          <mat-option *ngFor="let option of alltimeslotLists" [value]="option.starttime">
                            {{option?.starttime}}
                          </mat-option> 
                        </ng-container>
                        <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length == 0">
                          <mat-option>
                            <span>No Record</span>
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-md-6">
                    <mat-form-field class="example-full-width">
                      <mat-select matInput formControlName="endtime" (selectionChange)="chooseTimeslot($event.value)"> 
                        <mat-option *ngIf="timeisLoadingBox" class="is-loading">
                          <mat-spinner diameter="50"></mat-spinner>
                        </mat-option>
                        <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length > 0">
                          <mat-option *ngFor="let option of alltimeslotLists" [value]="option.endtime">
                            {{option?.endtime}}
                          </mat-option>
                        </ng-container>
                        <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length == 0">
                          <mat-option>
                            <span>No Record</span>
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <!-- <div
                  [hidden]="serviceForm.get('timeslot').valid || (serviceForm.get('timeslot').pristine && !s_submitted)"
                  class="text-danger">
                  <small *ngIf="serviceForm.get('timeslot').hasError('required')" class="error-label">
                    {{getLang('timeslotisrequired', 'Time Slot is required !')}}
                  </small>
                </div> -->

              </div>

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('charges', 'Charges')}}
                  <span class="text-danger">*</span>
                </label>
                <mat-form-field class="example-full-width">
                  <input matInput type="number" formControlName="cost">
                </mat-form-field>
              </div>

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('taxes', 'Taxes')}}
                </label>

                <mat-form-field class="example-full-width">
                  <mat-select matNativeControl multiple formControlName="taxes">
                    <mat-option [value]="tax" *ngFor="let tax of selectedService?.taxes">
                      {{tax?.taxname}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('status', 'Status')}}
                  <span class="text-danger">*</span>
                </label>
                <mat-form-field class="example-full-width" appearance="standard">
                  <mat-select placeholder="Choose option" formControlName="status" matNativeControl>
                    <mat-option [value]="status.code" *ngFor="let status of statusList">{{status.value}}</mat-option>
                  </mat-select>
                </mat-form-field>
                <div [hidden]="serviceForm.get('status').valid || (serviceForm.get('status').pristine && !s_submitted)"
                  class="text-danger">
                  <small *ngIf="serviceForm.get('status').hasError('required')" class="error-label">
                    {{getLang('statusrequired ', 'Status should be required
                    !')}}
                  </small>
                </div>
              </div>

              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('couponcode', 'Coupon Code')}}
                </label>
                <mat-form-field class="example-full-width" appearance="standard">
                  <input type="text" matInput [matAutocomplete]="auto" placeholder="Enter Coupon"
                    (keyup)="enterCoupon($event)" [(ngModel)]="selectedCoupon"  formControlName="couponcode">
                  <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCn"  (optionSelected)='onCouponSelectForService()'>
                    <ng-container *ngIf="couponList.length > 0">
                      <mat-option *ngFor="let option of couponfilteredOptions | async" [value]="option">
                        {{option.couponcode}}
                      </mat-option>
                    </ng-container>
                    <ng-container *ngIf="couponList.length == 0">
                      <mat-option>
                        <span>{{getLang('norecord', 'No Record')}}</span>
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
              
              <div class="col-sm-6" *ngIf="serviceForm.get('coupondiscount').value">
                  <label class="col-form-label">
                    {{getLang('coupndiscount','Coupon discount')}}
                  </label>
                <mat-form-field class="example-full-width">  
                    <input type="number"  formControlName="coupondiscount" matInput >
                </mat-form-field>
              </div>

              <div class="col-sm-6"  *ngIf="serviceForm.get('couponcode')?.value?.couponcode == 'Override Price'">
                <label class="col-form-label">
                  {{getLang('discountrsn', 'Discount reason')}}
                </label>
                <dynamic-autocomplete  *ngIf="discount_fields.visible" 
                    [formControlName]="discount_fields.fieldname"
                    [setting]="discount_fields"
                    [dbvalue]="discount_fields.dbvalue">
                </dynamic-autocomplete>
              </div>

              <div class="col-sm-6" *ngIf="serviceForm.get('couponcode')?.value?.couponcode == 'Override Price'">
                <label class="col-form-label">
                  {{getLang('discount', 'Discount')}}
                </label>
                <mat-form-field class="example-full-width">
                  <input matInput type="number" formControlName="discount">
                </mat-form-field>
                <div
                  [hidden]="serviceForm.get('discount').valid || (serviceForm.get('discount').pristine && !s_submitted)"
                  class="text-danger">
                  <small *ngIf="serviceForm.get('discount').hasError('insertonlypositivenumber')" class="error-label">
                    {{getLang('discountshouldbepositive ', 'Discount should be positive !')}}
                  </small>
                </div>
              </div>  


            </div>
          </div>
          <div class="modal-footer">
            <button type="button" [disabled]="disableBtn" data-dismiss="modal" (click)="closeService(selectedService)"
              class="btn btn-default">
              <i class="material-icons">close</i>
              {{getLang('cancel', 'Cancel')}} 
            </button> 
            <button type="submit" [disabled]="disableBtn" class="btn btn-primary ml-2">
              <i class="material-icons">save</i>
              {{getLang('save', 'Save')}}
            </button>
          </div>
        </div>
        </form>
    </ng-container>
  </div>
</div>


<div id="giftcardmodal" data-toggle="modal" data-target="#giftcard" ></div>

<div class="modal fade" id="giftcard" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-scrollable">
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">  Git card of {{selectedItem?.itemname}}
              </h4>
              <button mat-button type="button" id="gcClose" class="close" data-dismiss="modal" aria-hidden="true">
                  <i class="material-icons">clear</i>
              </button>
          </div>
          <div class="modal-body">
              <div class="row"> 
                  <div class="col-md-12">
                      <label class="col-form-label">
                          {{getLang('giftcard','Gitcard')}}
                      </label>
                      <mat-form-field class="example-full-width">
                          <input type="text" matInput [(ngModel)]="selectedItem.itemnumber" >
                      </mat-form-field>
                  </div>

                  <div class="col-md-6">
                    <label class="col-form-label">
                      {{getLang('expires','Expires')}}
                      <span class="text-danger">*</span>
                    </label>
                    <mat-form-field class="example-full-width">
                      <input matInput [(ngModel)]="selectedItem.valid" [matDatepicker]="pickergcvd"
                          placeholder="Expires date">
                      <mat-datepicker-toggle matSuffix [for]="pickergcvd"></mat-datepicker-toggle>
                      <mat-datepicker #pickergcvd></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="col-md-6">
                    <label class="col-form-label">
                        {{getLang('qty','Quantity')}}
                    </label>
                    <mat-form-field class="example-full-width">
                        <input type="number" matInput [(ngModel)]="selectedItem.quantity" >
                    </mat-form-field>
                  </div>
                
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-default" type="button" data-dismiss="modal">
                  <i class="material-icons">close</i> {{getLang('cancel','Cancel')}}
              </button>
              <button class="btn btn-primary ml-2" type="button" (click)=onGiftCardAdd()>
                  <i class="material-icons">save</i> {{getLang('save','Save')}}
              </button>
          </div>
      </div>
  </div>
</div>



<div id="giftcertficatemodal" data-toggle="modal" data-target="#giftcertificate"></div>
<div class="modal fade" id="giftcertificate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-scrollable">
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">  Git Certificate
              </h4>
              <button mat-button type="button" id="gctClose" class="close" data-dismiss="modal" aria-hidden="true">
                  <i class="material-icons">clear</i>
              </button>
          </div>
            <div class="modal-body">
                  <div fxLayout="row" *ngIf="loadingprd" fxLayoutAlign="space-around center"
                    style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
                    <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
                  </div>
            <ng-container *ngIf="!loadingprd">
              <div class="row"> 
                  <div class="col-md-12">
                    <label class="col-form-label">
                      {{getLang('to','To')}}
                      <span class="text-danger">*</span>
                    </label>
                    <mat-form-field class="example-full-width">
                        <input type="text" matInput [(ngModel)]="selectedItem.to">
                    </mat-form-field>
                  </div>

                  <div class="col-md-12">
                    <label class="col-form-label">
                      {{getLang('style','Style')}}
                    </label>
                    <div class="d-flex align-items-center">
                      <mat-form-field class="example-full-width">
                          <input type="text" matInput [value]="selectedItem.itemname" readonly>
                      </mat-form-field>
                      <a href="javascript:void(0);" (click)="previewGRC()"  > {{getLang('preview','Preview')}}</a>
                     </div>
                  </div>

                  <div class="col-md-12">
                    <label class="col-form-label">
                      {{getLang('expires','Expires')}}
                      <span class="text-danger">*</span>
                    </label>
                    <mat-form-field class="example-full-width">
                      <input matInput [(ngModel)]="selectedItem.valid" [matDatepicker]="pickervd"
                          placeholder="Expires date">
                      <mat-datepicker-toggle matSuffix [for]="pickervd"></mat-datepicker-toggle>
                      <mat-datepicker #pickervd></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="col-md-12">
                    <label class="col-form-label">
                      {{getLang('cost','Cost')}}
                    </label>
                    <mat-form-field class="example-full-width">
                        <input type="text" matInput   [value]="selectedItem && selectedItem.sale ? selectedItem.sale.rate : 0" readonly>
                    </mat-form-field>
                  </div>


                  <div class="col-md-12">
                    <label class="col-form-label">
                      {{getLang('qty','Quantity')}}
                      <span class="text-danger">*</span>
                    </label>
                    <mat-form-field class="example-full-width">
                        <input type="number" matInput [(ngModel)]="selectedItem.quantity" oninput="this.value = Math.abs(this.value)">
                    </mat-form-field>
                  </div> 
 
              </div>
            </ng-container>
          </div>
          <div class="modal-footer">
              <button class="btn btn-default" type="button" data-dismiss="modal">
                  <i class="material-icons">close</i> {{getLang('cancel','Cancel')}}
              </button>
              <button class="btn btn-primary ml-2" type="button" (click)="ondGiftCrtfAdd()">
                  <i class="material-icons">save</i> {{getLang('save','Save')}}
              </button>
          </div>
      </div>
  </div>
</div>


<div id="productModal" data-toggle="modal" data-target="#product"></div>
<div class="modal fade" id="product" tabindex="-1">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="ConfirmModalLabel"> {{getLang('prddetls', 'Product details ')}}</h4> 
          <button type="button" id="closecn"   class="close" data-dismiss="modal"
            aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            
            <div fxLayout="row" *ngIf="loadingprd" fxLayoutAlign="space-around center"
              style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
              <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
            </div>
          <div class="table-responsive" *ngIf="!loadingprd" >
            <table class="table table-membroz table-pos">
              <thead>
                <tr>
                  <th>{{getLang('product', 'Product')}}</th>
                  <th class="text-center">{{getLang('rate', 'Rate')}}</th>
                  <th class="text-center">{{getLang('discount', 'Discount')}}</th>
                  <th class="text-right">{{getLang('qty', 'Qty')}}</th> 
                  <th class="text-right" >{{getLang('price', 'Price')}}</th>
                </tr>
              </thead>
              <tbody>
                <tr> 
                  <td>{{selectedItem?.itemname}} </td>
                  <td class="text-center text-nowrap">
                    {{selectedItem?.sale?.rate | myCurrencyPipe}}
                  </td>
                  <td class="text-center text-nowrap">
                    {{selectedItem?.discount ?  (selectedItem?.discount | myCurrencyPipe ) : ''}}
                  </td>
                  <td class="text-right text-nowrap">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove" style="width: 70px;">
                      <input type="number" matInput  [(ngModel)]="selectedItem.quantity" (input)="onstaticqty($event.target.value)" [disabled]="isPaymentMode" oninput="this.value = Math.abs(this.value)" style="text-align:right;">
                  </mat-form-field>
                </div>
                  </td>
                  <td class="text-right text-nowrap"> 
                    {{selectedItem?.totalcost | myCurrencyPipe}}
                   </td>
                </tr>

                <tr>
                  <td colspan="4"> 
                    <div class="form-inline">
                      <div class="mr-2">Sold by</div>
                      <app-dynamic-autocomplete-ngmodel *ngIf="provider_fields.visible" [(inputModel)]="provider_fields.modelValue" [setting]="provider_fields" [classes]="'inside-autocomplete-m-remove min-width-320'"
                      [dbvalue]="provider_fields.dbvalue" >
                    </app-dynamic-autocomplete-ngmodel>
                    </div> 
                   
                  </td>
                  
                  <td class="text-right">
                    <div>
                      <mat-form-field class="example-full-width mat-form-field-space-remove" appearance="standard">
                        <input type="text" matInput [matAutocomplete]="auto" placeholder="Enter Coupon"
                          (keyup)="enterCoupon($event)" [(ngModel)]="selectedCoupon" (change)="handleEmptyInput($event)" style="text-align: right;">
                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCn"  (optionSelected)='onCouponSelect($event.option.value)'>
                          <ng-container *ngIf="couponList.length > 0">
                            <mat-option *ngFor="let option of couponfilteredOptions | async" [value]="option">
                              {{option.couponcode}}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="couponList.length == 0">
                            <mat-option>
                              <span>{{getLang('norecord', 'No Record')}}</span>
                            </mat-option>
                          </ng-container>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>
                  </td>
                </tr>

                <tr *ngIf="selectedCoupon && selectedCoupon.coupondiscount">
                  <td colspan="3"></td>
                  <td>Coupons discount </td>
                  <td class="text-right">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove">
                        <input type="number" matInput disabled [value]="selectedCoupon.coupondiscount" style="text-align: right;" >
                    </mat-form-field>
                  </div>
                  </td>
                </tr>

                <tr *ngIf="selectedCoupon && selectedCoupon.coupondiscount">
                  <td colspan="3"></td>
                  <td>Total </td>
                  <td class="text-right">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove">  
                        <input type="number" matInput disabled [value]="selectedCoupon.finaltotalcost" style="text-align: right;">
                    </mat-form-field>
                  </div>
                  </td>
                </tr>


              </tbody>
            </table>
          </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" data-dismiss="modal" 
            class="btn btn-default" [disabled]="disableBtn">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}
          </button>
          <button type="button" (click)="onDonePrd()" [disabled]="disableBtn" class="btn btn-primary ml-2">
            <i class="material-icons">save</i>
            {{getLang('save', 'Save')}}
          </button>
        </div>
      </div> 
  </div>
</div>



<div id="newsrvcModal" data-toggle="modal" data-target="#myModalAppointment"></div>
<div id="myModalAppointment" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">{{getLang('appointment','Appointment')}}</h4>
              <button type="button" id="appointmentClose" (click)="addAppointmnet = !addAppointmnet" class="close " data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
              <app-appointment-booking
                  *ngIf="addAppointmnet"
                  #appintmentadd
                  [dataContent]="this.searchMember"
                  [type]="'multi'"
                  [frontdeskdata]="selectInfo"
                  [passondate]="this.selectedDate"
                  (onAppointmentData)="getSubmittedData($event)">
              </app-appointment-booking>
          </div>

      </div>
  </div>
</div>