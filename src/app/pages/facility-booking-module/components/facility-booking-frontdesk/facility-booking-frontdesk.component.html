<div class="main-content">
  <div class="container-fluid">
    <div fxLayout="row" *ngIf="isLoadingData" fxLayoutAlign="space-around center"
      style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
      <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
    </div>

    <div class="row table-item-gutters" *ngIf="!isLoadingData">
      <div class="col-xl-4 col-lg-4 col-md-5 pr-md-0">
        <div class="card mb-0" *ngIf="!isPaymentMode">
          <div class="px-3">
            <mat-form-field class="example-full-width" appearance="standard">
              <input type="text" matInput #trigger="matAutocompleteTrigger"  [matAutocomplete]="auto" [formControl]="memberControl"
                [placeholder]="getLang('searchcustomerormember', 'Search Customer or Member')"
                (keyup)="enterCustomer($event)" (dblclick)="trigger.openPanel()">
              <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn"
                (optionSelected)="inputModelChangeValue()">
                <mat-option *ngIf="customerisLoadingBox" class="is-loading">
                  <mat-spinner diameter="50"></mat-spinner>
                </mat-option>
                <ng-container *ngIf="!customerisLoadingBox && customerList.length > 0">
                  <mat-option *ngFor="let option of customerfilteredOptions | async" [value]="option">
                    {{option.nickname}}
                  </mat-option>
                </ng-container>
                <!-- <ng-container *ngIf="!customerisLoadingBox && customerList.length == 0">
                  <mat-option>
                    <span>{{getLang('norecord', 'No Record')}}</span>
                  </mat-option>
                </ng-container> -->
              </mat-autocomplete>
              <mat-icon matPrefix *ngIf="!searchMember" >search</mat-icon>
              <button matSuffix  class="btn btn-just-icon btn-link m-0 p-0"  [disabled]="disableBtn" (click)="clearMember()" *ngIf="searchMember && searchMember._id">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>
        </div>
        <div class="card pos-itembill-card mb-0">
          <div class="d-flex customer-name-p ">
            <div class="flex-grow-1 font-weight-bold">
              <div *ngIf="searchMember">
                <div>{{searchMember?.fullname}} {{searchMember?.membernumber ? ' | ' + searchMember?.membernumber : ''}}
                </div>
                <div>{{searchMember?.primaryemail}}</div>
                <div>{{searchMember?.mobile}}</div>
              </div>
            </div>
            <div>
              <button type="button"   class="btn btn-primary text-nowrap" data-toggle="modal" data-target="#customerModal"
                *ngIf="!isPaymentMode && !isDisableEdit">  <i class="material-icons">person_add_alt</i> {{getLang('newcustomer', 'New')}}
              </button>
            </div>
          </div>
          <div class="loader" *ngIf="isLoadingCart">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
            </svg>
          </div>
          <div class="table-responsive">
            <table class="table table-membroz table-pos mb-0">
              <thead>
                <tr>
                  <th>{{getLang('product', 'Product')}}</th>
                  <th class="text-center" colspan="2">{{getLang('qty', 'Qty')}}</th>
                  <th class="text-right">{{getLang('price', 'Price')}}</th>                  
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let items of cartItemList">
                  <td>{{items?.item?.itemname}} {{ items.itemnumber ? "(#" + items?.itemnumber + ")": '' }} </td>
                  <td class="text-center text-nowrap" colspan="2">
                    <!-- <a href="javascript:void(0)" [class.disabled]="items.quantity == 1" (click)="onSubtrct(items.item)"
                      *ngIf="!isPaymentMode">
                      <img src="../../../../../assets/img/pos-minus-icon.svg" alt="" class="mr-2">
                    </a>
                    {{items.quantity}}
                    <a href="javascript:void(0)" (click)="onAdd(items.item)" *ngIf="!isPaymentMode">
                      <img class="ml-2" src="../../../../../assets/img/pos-plus-icon.svg" alt="">
                    </a> -->
                    <mat-form-field class="example-full-width mat-form-field-space-remove" style="width: 70px;">
                        <input type="number" matInput  [(ngModel)]="items.quantity" style="text-align: right;" [disabled]="isPaymentMode" (input)="onChangeQty($event.target.value ,items.item)" oninput="this.value = Math.abs(this.value)">
                    </mat-form-field>
                  </td>
                  <td class="text-right align-top">
                    <div>{{items?.item?.sale?.rate | myCurrencyPipe}} </div>
                    <div *ngIf="items?.discount">-{{items?.discount | myCurrencyPipe}}</div>
                    <div *ngIf="items?.coupondiscount">-{{items?.coupondiscount | myCurrencyPipe}}</div>
                    <div>
                      <a class="mr-2" href="javascript:void(0)" [class.disabled]="disableBtn" (click)="onRemove(items.item,items)"
                        *ngIf="!isPaymentMode">
                        <img src="../../../../../assets/img/pos-delete-icon.svg" alt="">
                      </a>
                      <a class="mr-2" href="javascript:void(0)" (click)="onEditPrd(items, true);checkCpn()" *ngIf="!isPaymentMode">
                        <img src="../../../../../assets/img/edit-gray-icon.svg" alt="">
                      </a>
                    </div>
                   </td>
                </tr>
                <ng-container *ngIf="cartItemList.length == 0">
                  <tr>
                    <td><span >{{getLang('noproduct', 'No Product')}}</span></td>
                  </tr>                  
                </ng-container>
              </tbody>
            </table>

            <table class="table table-membroz table-pos">
                <tbody>
                  <ng-container *ngIf="servicecartList.length > 0" >
                  <th colspan="4" > {{getLang('facility', 'Facility')}}</th>
                <tr *ngFor="let item of servicecartList">
                  <td width="70" style="padding-right: 0 !important;vertical-align: top;"  >
                    <div class="attend-holiday-box text-center">
                       <div class="font-weight-600">{{item?.duration}}m</div>
                       <div class="font-14">{{item?.timeslot?.starttime }}</div>
                    </div>
                  </td>
                  <td style="padding-right: 0 !important;vertical-align: top;">
                      <div class="font-weight-600"> {{item?.title}}
                        <span class="ml-1 font-weight-600 font-14 fc-today-button"
                          [ngClass]="{'ts-text-blue': item?.status == 'requested',
                          'attend-text-green': item?.status == 'confirmed',
                          'attend-text-red': item?.status == 'cancel',
                          'pos-text-jambli': item?.status == 'checkout',
                          'pricing-color-1': item?.status == 'inwaiting',
                          'text-secondary': item?.status == 'noshow'}">
                          {{item?.status}}
                        </span>
                        </div>
                      <div>{{item?.host?.fullname}}</div>
                  </td>
                  <td colspan="2" class="text-right align-top">
                      <div>{{item?.cost | myCurrencyPipe}}</div>
                      <div *ngIf="item.discount">{{item?.discount | myCurrencyPipe}}</div>
                      <div>
                        <a href="javascript:void(0)" [class.disabled]="disableBtn" (click)="onRemoveService(item)"
                          *ngIf="!isPaymentMode"> <img src="../../../../../assets/img/pos-delete-icon.svg" alt=""> </a>
                        <span class="ml-2">
                          <a href="javascript:void(0)" [class.disabled]="disableBtn" data-toggle="modal"
                            (click)="onClickService(item.refid)" data-target="#serviceModal" *ngIf="!isPaymentMode"> <img
                              src="../../../../../assets/img/edit-gray-icon.svg" alt=""> </a>
                        </span>
                      </div>
                  </td>
                </tr>
              </ng-container>

                <tr>
                  <td colspan="4">&nbsp;</td>
                </tr>
                <tr *ngIf="discount">
                  <td class="border-bottom" colspan="3">{{getLang('discount', 'Discount')}}</td>
                  <td class="text-right border-bottom">{{discount | myCurrencyPipe}} </td>
                </tr>
                <tr class="d-none">
                  <td class="font-weight-bold border-bottom" colspan="3">{{getLang('subtotal', 'Subtotal')}}</td>
                  <td class="text-right font-weight-bold border-bottom">{{subtotal | myCurrencyPipe}}</td>
                </tr>
                <!-- <tr>
                  <td class="border-bottom" colspan="2">Tax Detail</td>
                  <td class="text-right border-bottom">
                    <table>
                      <tr *ngFor="let taxes of taxesList">
                        <td> {{taxes?.taxname}} </td>
                        <td> {{taxes?.amount | myCurrencyPipe}} </td>
                      </tr>
                    </table>
                  </td>

                </tr> -->

                <tr *ngIf="packagediscount">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('packagediscount', 'Package
                    discount')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18">{{packagediscount | myCurrencyPipe}}
                  </td>
                </tr>
                <tr *ngIf="taxamount">
                  <td class="border-bottom" colspan="3">{{getLang('tax', 'Tax')}}</td>
                  <td class="text-right border-bottom">{{taxamount | myCurrencyPipe}}</td>
                </tr>

                <tr>
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('grandtotal', 'Grand
                    Total')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18">{{grandtotal | myCurrencyPipe}}</td>
                </tr>

                <tr *ngIf="status && status != 'Unpaid'">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('paidamount', 'Paid Amount')}}</td>
                  <td
                  class="text-right font-weight-bold border-bottom font-18">{{paidamount | myCurrencyPipe}}</td>
                </tr>

                <tr  *ngIf="status && status != 'Unpaid'">
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('balance', 'Balance')}}</td>
                  <td
                  class="text-right font-weight-bold border-bottom font-18">{{balance | myCurrencyPipe}}</td>
                </tr>

                <tr>
                  <td class="font-weight-bold border-bottom font-18" colspan="3">{{getLang('remainingiouamount',
                    'IOU Amount')}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18" *ngIf="outstandingamount == 0">
                    {{outstandingamount | myCurrencyPipe}}</td>
                  <td class="text-right font-weight-bold border-bottom font-18" *ngIf="outstandingamount > 0">
                    <a href="javascript:void(0)" (click)="checkIOUMode()" style="color: red;"> {{outstandingamount |
                      myCurrencyPipe}}</a>
                  </td>
                </tr>

                <tr *ngIf="visible">
                  <td colspan="4" >
                   <div class="p-1" >
                    <app-dynamic-property-fields
                      [formid]="formObj._id"
                      [myForm]="billform"
                      [mySubmitted]="this.isSubmitted"
                      [bindIdData]="_propertyobjectModel">
                    </app-dynamic-property-fields>
                   </div>
                  </td>
                </tr>

              </tbody>
            </table>
          </div> 
          <ng-container *ngIf="!_billModel.status || _billModel.status != 'Paid';else paidDisplay">
            <div class="customer-name-p" >
              <div class="row" *ngIf="!isPaymentMode">
                <div class="pr-0" [ngClass]="_billModel && _billModel._id ? 'col-4' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onNewBill()"
                    class="btn btn-primary btn-block">{{getLang('savebill', 'Save Bill')}}</button>
                </div>
                <div [ngClass]="_billModel && _billModel._id ? 'col-4 pr-0' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onCheckout()"
                    class="btn btn-success btn-block">{{getLang('checkout', 'Checkout')}}</button>
                </div>

                <div *ngIf="_billModel && _billModel._id" [ngClass]="_billModel && _billModel._id ? 'col-4' : 'col-6'">
                  <button type="button" [disabled]="disableBtn" (click)="onPrint(_billModel._id)"
                    class="btn btn-success btn-block">{{getLang('print', 'Print')}}</button>
                </div>
              </div>
              <ng-container  *ngIf="isPaymentMode">
                <div class="row" *ngIf="status && status == 'Unpaid'">
                  <div class="col-12">
                    <button type="button" [disabled]="disableBtn" (click)="onMoreOption()"
                      class="btn btn-success btn-block">{{getLang('addmore', 'Add More')}}</button>
                  </div>
                </div>
                <div class="row" *ngIf="_billModel && _billModel._id && status && status == 'Partial'">
                  <div class="col-md-12">
                      <!--display if done some payment  *ngIf="balance != 0 && balance != grandtotal"  -->
                        <button  type="button" (click)="setNewPayment()"
                                class="btn btn-success btn-block">{{getLang('newpymn', 'New Payment')}}
                        </button>
                  </div>
                </div>
            </ng-container>
            </div>
          </ng-container>
          <ng-template #paidDisplay>
            <div *ngIf="_billModel && _billModel._id" class="col-12">
              <button type="button" [disabled]="disableBtn" (click)="onPrint(_billModel._id)"
                class="btn btn-success btn-block">{{getLang('viewreciept', 'View Reciept')}}</button>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="col-xl-8 col-lg-8 col-md-7">
        <ng-container *ngIf="!isPaymentMode;else templateMode">
          <div class="pr-md-0">
              <div class="row">
                <div class="col-xl-12">

                  <mat-tab-group class="frontdesk-tab-card" [(selectedIndex)]="selectedIndexes"  (selectedTabChange)="onTabChanged($event)">
                    <mat-tab label="Front Desk">
                      <ng-template matTabContent>
                        <div class="card px-3 mt-0">
                          <div class="row">
                            <div class="col-md-5 col-lg-6 col-xl-3 mr-auto">
                              <mat-form-field class="example-full-width">
                                <input matInput [(ngModel)]="selectedDate" [matDatepicker]="picker"
                                  (dateChange)="onDateChanged()" placeholder="Booking date"
                                  [disabled]="isDisableEdit">
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                              </mat-form-field>
                            </div>
                            <div class="col-md-7 col-lg-6 col-xl-4 ml-auto">
                              <form [formGroup]="statusFormGroup">
                                <mat-form-field>
                                  <mat-select placeholder="Status" name="status" multiple formControlName="status">
                                    <app-mat-option-select-all></app-mat-option-select-all>
                                    <mat-option *ngFor="let item of statusList" [value]="item.code"> {{item.value}}
                                    </mat-option>
                                  </mat-select>
                                </mat-form-field>
                              </form>
                            </div>
                          </div>
                        </div>

                        <div class="loader" *ngIf="isLoadings['facilitybooking']">
                          <svg class="circular" viewBox="25 25 50 50">
                            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2"
                              stroke-miterlimit="10" />
                          </svg>
                        </div>

                        <div class="row card-item-gutters mt-3">
                          <div class="col-xl-3 col-lg-3 col-md-4 col-sm-4 col-6 d-flex">
                            <div class="card pos-menu-card w-100 mnh-200" (click)="newAppointment()">
                              <div class="card-body p-2">
                                <div class="d-flex flex-column align-items-center">
                                  <div class="d-flex align-items-center my-3">
                                    <div class="badge badge-customer-name" style="background-color :crimson">
                                      New
                                    </div>
                                  </div>
                                  <div class="fd-customer-title mb-1">New Booking
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-xl-3 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                            *ngFor="let app of facilitybookingList;let i = index">
                            <div class="card pos-menu-card w-100" [ngClass]="{'selected': app.selected}">
                              <div class="card-body p-2">
                                <div class="d-flex flex-column align-items-center">
                                  <div class="d-flex align-items-center my-3">
                                    <span class="img-add-product-delete" *ngIf="app.viewCancel">
                                      <button mat-raised-button type="button" [disabled]="disableBtn"
                                        class="btn btn-just-icon btn-link" (click)="onRemoveApp(app)">
                                        <i class="material-icons font-18">cancel</i>
                                      </button>
                                    </span>
                                    <div class="badge badge-customer-name"
                                      [ngStyle]="{'background-color' : getColor(app.status)}" (click)="onClickApp(app)">
                                      {{app?.shrname}}
                                    </div>
                                  </div>
                                  <div class="fd-customer-title mb-1" (click)="onClickApp(app)">{{ app.customerid ? app?.customerid?.fullname :
                                    '---'}}
                                  </div>
                                  <div class="text-center mb-1 font-13" (click)="onClickApp(app)">{{app?.refid?.title}}</div>
                                  <div class="text-center mb-1 font-13" (click)="onClickApp(app)">{{app?.refid?.charges}}</div>

                                  <div class="font-12 text-uppercase font-weight-bold" [ngClass]="{'ts-text-blue': app?.status == 'requested',
                                    'attend-text-green': app?.status == 'confirmed',
                                    'attend-text-red': app?.status == 'cancel',
                                    'pos-text-jambli': app?.status == 'checkout',
                                    'pricing-color-1': app?.status == 'inwaiting',
                                    'text-secondary': app?.status == 'noshow'}"  (click)="onClickApp(app)">
                                    {{app?.status}}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                      </ng-template>
                    </mat-tab>
                    <mat-tab label="Product">
                      <div class="card px-3 mt-0">
                        <div class="row">
                          <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                            <mat-form-field class="example-full-width pt-0" appearance="standard">
                              <input matInput #gsearch placeholder="Search item name or barcode" id="global_search_terms"
                                [(ngModel)]="searchBox.value" (ngModelChange)="onSearchItem()">
                              <span class="material-input"></span>
                            </mat-form-field>
                          </div>
                        </div>

                      </div>

                      <ng-container *ngIf="billItemListGrp && billItemListGrp.length > 0;else prTmpl">
                        <mat-tab-group [(selectedIndex)]="searchBox.index">
                          <mat-tab label="All">
                            <div class="row card-item-gutters mt-3">
                              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                                *ngFor="let item of billItemList">
                                <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                  [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                  <ng-container *ngIf="item.quantity && item.quantity > 0">
                                    <div class="box-item-selected">{{item?.quantity}}</div>
                                  </ng-container>
                                  <img
                                    [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                    class="card-img-top card-img-size" alt="">
                                  <div class="card-body p-2">
                                    <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                    <div class="card-item-price">{{item?.sale?.rate | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </mat-tab>
                          <ng-container *ngFor="let itemList of billItemListGrp">
                            <mat-tab [label]="itemList[0].category">
                              <div class="row card-item-gutters mt-3">
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex" *ngFor="let item of itemList">
                                  <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                    [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                    <ng-container *ngIf="item.quantity && item.quantity > 0">
                                      <div class="box-item-selected">{{item?.quantity}}</div>
                                    </ng-container>
                                    <img
                                      [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                      class="card-img-top card-img-size" alt="">
                                    <div class="card-body p-2">
                                      <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                      <div class="card-item-price">{{item?.sale?.rate | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </mat-tab>
                          </ng-container>
                        </mat-tab-group>
                    </ng-container>
                    <ng-template #prTmpl>
                      <h3 class="text-center"> No Products available ! </h3>
                      <div class="d-flex justify-content-center">
                        <button class="btn btn btn-outline-primary m-0 mr-2" [routerLink]="['/pages/product-module/form']">
                            <i class="material-icons" >add</i> Add New Product
                        </button>
                      </div>
                    </ng-template>
                    </mat-tab>
                    <mat-tab label="Facility">
                      <div class="card px-3 mt-0">
                        <div class="row">
                          <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                            <mat-form-field class="example-full-width pt-0" appearance="standard">
                              <input matInput #gsearch placeholder="Search service" id="global_search_terms"
                                [(ngModel)]="searchService.value" (ngModelChange)="onSearchService()">
                              <span class="material-input"></span>
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                      <ng-container *ngIf="serviceListGrp && serviceListGrp.length > 0;else srTmpl">
                      <mat-tab-group [(selectedIndex)]="searchService.index">
                        <mat-tab label="All">
                          <div class="row card-item-gutters mt-3">
                            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                              *ngFor="let item of serviceList">
                              <div class="card pos-menu-card w-100" data-toggle="modal" (click)="onClickService(item._id)"
                                data-target="#serviceModal" [ngClass]="{'selected': item.selected}">
                                <img
                                  [src]="item.gallery && item.gallery.length > 0 ?  item.gallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                  class="card-img-top card-img-size" alt="">
                                <div class="card-body p-2">
                                  <div class="card-item-title mb-1">{{item?.title}}</div>
                                  <div class="card-item-price">{{(item?.charges) | myCurrencyPipe}}</div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </mat-tab>
                        <ng-container *ngFor="let itemList of serviceListGrp">
                          <mat-tab [label]="itemList[0].categoryname">
                            <div class="row card-item-gutters mt-3">
                              <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex" *ngFor="let item of itemList">
                                <div class="card pos-menu-card w-100" data-toggle="modal"
                                  (click)="onClickService(item._id)" data-target="#serviceModal"
                                  [ngClass]="{'selected': item.selected}">
                                  <img
                                    [src]="item.gallery && item.gallery.length > 0 ?  item.gallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                    class="card-img-top card-img-size" alt="">
                                  <div class="card-body p-2">
                                    <div class="card-item-title mb-1">{{item?.title}}</div>
                                    <div class="card-item-price">{{(item?.charges | myCurrencyPipe)}}</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </mat-tab>
                        </ng-container>
                      </mat-tab-group>
                    </ng-container>
                    <ng-template #srTmpl>
                      <h3 class="text-center"> No Facilities available ! </h3>
                      <div class="d-flex justify-content-center">
                        <button class="btn btn btn-outline-primary m-0 mr-2" [routerLink]="['/pages/service-module/asset-form']">
                            <i class="material-icons" >add</i> Add New Facility
                        </button>
                    </div>
                    </ng-template>
                    </mat-tab>

                    <mat-tab label="Giftcards">
                      <ng-container *ngIf="giftCardList && giftCardList.length > 0;else gcTmpl">
                         <div class="row card-item-gutters mt-3">
                            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                              *ngFor="let item of giftCardList">
                              <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                <ng-container *ngIf="item.quantity && item.quantity > 0">
                                  <div class="box-item-selected">{{item?.quantity}}</div>
                                </ng-container>
                                <img
                                  [src]="item.imagegallery && item.imagegallery.length > 0 ?  item.imagegallery[0].attachment : '../../../../../assets/img/image_placeholder.jpg'"
                                  class="card-img-top card-img-size" alt="">
                                <div class="card-body p-2">
                                  <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                  <div class="card-item-price">{{item?.sale?.rate  | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                </div>
                              </div>
                            </div>
                          </div>
                      </ng-container>
                      <ng-template #gcTmpl>
                        <h3 class="text-center"> No Gitcard available ! </h3>
                      </ng-template>
                    </mat-tab>

                    <mat-tab label="Giftcertificate">

                      <div class="card px-3 mt-0">
                        <div class="row">
                          <div class="col-md-7 col-lg-6 col-xl-5 ml-auto">
                            <mat-form-field class="example-full-width pt-0" appearance="standard">
                              <input matInput #gsearch placeholder="Search item name or barcode" id="global_search_terms"
                                [(ngModel)]="searchBox.value" (ngModelChange)="onSearchGCR()">
                              <span class="material-input"></span>
                            </mat-form-field>
                          </div>
                        </div>
                      </div>

                      <ng-container *ngIf="giftCertificateList && giftCertificateList.length > 0;else grcTmpl">
                          <div class="row card-item-gutters mt-3">
                            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-4 col-6 d-flex"
                              *ngFor="let item of giftCertificateList">
                              <div class="card pos-menu-card w-100" (click)="onAdd(item)"
                                [ngClass]="{'selected': item.quantity && item.quantity > 0}">
                                <ng-container *ngIf="item.quantity && item.quantity > 0">
                                  <div class="box-item-selected">{{item?.quantity}}</div>
                                </ng-container>
                                <img
                                  [src]="item?.property?.thumbnail ? item?.property?.thumbnail : '../../../../../assets/img/image_placeholder.jpg'"
                                  class="card-img-top card-img-size" alt="">
                                <div class="card-body p-2">
                                  <div class="card-item-title mb-1">{{item?.itemname}}</div>
                                  <div class="card-item-price">{{item?.sale?.rate  | myCurrencyPipe}} {{item.enableinventory && item.stock ?  '(' + item.stock + ')' : '' }} </div>
                                </div>
                              </div>
                            </div>
                          </div>
                      </ng-container>
                      <ng-template #grcTmpl>
                        <h3 class="text-center"> No Gift Certificate available ! </h3>
                      </ng-template>
                    </mat-tab>
                  </mat-tab-group>

                </div>
              </div>
          </div>
      </ng-container>
      <ng-template #templateMode>
        <div>
          <app-bill-check-out *ngIf="!isIOUMode && !isLoadingCart &&  _billModel && _billModel._id" #billcheckout [billid]="_billModel._id" [billpayid]="billpayid" [formname]="'bill'" [payformname]="'billpayment'">
          </app-bill-check-out>
          <app-bill-iou-checkout *ngIf="isIOUMode && !isLoadingCart" [searchMember]="searchMember"
            [outstandingamount]="outstandingamount" (onMakePayment)="redirecttoURL($event)"
            (onBack)="onBackIOUMode($event)">
          </app-bill-iou-checkout>
        </div>
      </ng-template>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="customerModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form [formGroup]="form" (ngSubmit)="onSubmitProspect(form.value,form.valid)" novalidate>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ConfirmModalLabel"> {{getLang('newcustomer', 'New Customer')}} </h5>
          <button type="button" id="close" (click)="form.reset();" class="close" data-dismiss="modal"
            aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('firstname', 'First Name')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="firstname" type="text">
              </mat-form-field>
              <div [hidden]="form.get('firstname').valid || (form.get('firstname').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('firstname').hasError('required')" class="error-label">
                  {{getLang('firstnameisrequired', 'firstname is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('lastname', 'Last Name')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="lastname" type="text">
              </mat-form-field>
              <div [hidden]="form.get('lastname').valid || (form.get('lastname').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('lastname').hasError('required')" class="error-label">
                  {{getLang('lastnameisrequired', 'lastname is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('mobile', 'Mobile')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="mobile" type="number">
              </mat-form-field>
              <div [hidden]="form.get('mobile').valid || (form.get('mobile').pristine && !submitted)"
                class="text-danger">
                <small *ngIf="form.get('mobile').hasError('required')" class="error-label">
                  {{getLang('mobileisrequired', 'Mobile is Required')}}
                </small>
                <small *ngIf="form.get('mobile').hasError('onlyvalidmobilenumber')" class="error-label">
                  {{getLang('validnumberisrequired', 'Valid Mobile is Required')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('email', 'Email')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput formControlName="primaryemail" type="text">
              </mat-form-field>
              <div [hidden]="form.get('primaryemail').valid || (form.get('primaryemail').pristine && !submitted)" class="text-danger">
                <small *ngIf="form.get('primaryemail').hasError('required')" class="error-label">
                  {{getLang('primaryemailisrequired', 'primaryemail is Required')}}
                </small>
                <small *ngIf="form.get('primaryemail').hasError('primaryemail')" class="error-label">
                  {{getLang('validprimaryemailisrequired', 'Valid Email is required')}}
                </small>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" [disabled]="disableBtn" data-dismiss="modal" (click)="form.reset()"
            class="btn btn-default">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}</button>
          <button type="submit" [disabled]="disableBtn" class="btn btn-primary ml-2">
            <i class="material-icons">save</i>
            {{getLang('save', 'Save')}}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="modal fade" id="serviceModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form [formGroup]="serviceForm" (ngSubmit)="onSubmitService(serviceForm.value,serviceForm.valid)" novalidate>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ConfirmModalLabel">
            {{serviceForm.get('title').value}}
            {{serviceForm.get('bookingdate').value | date}}
          </h5>
          <button type="button" id="closeservice" (click)="closeService(selectedService)" class="close"
            data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('timeslot', 'Time Slot')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field>
                <input type="text" matInput formControlName="timeslot" [matAutocomplete]="autoTime">
                <mat-autocomplete #autoTime="matAutocomplete" [displayWith]="timeDisplayFn">
                  <mat-option *ngIf="timeisLoadingBox" class="is-loading">
                    <mat-spinner diameter="50"></mat-spinner>
                  </mat-option>
                  <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length > 0">
                    <mat-option *ngFor="let option of timeslotfilteredOptions | async" [value]="option">
                      {{option?.displaytext}}
                    </mat-option>
                  </ng-container>
                  <ng-container *ngIf="!timeisLoadingBox && alltimeslotLists.length == 0">
                    <mat-option>
                      <span>Today facility is unavailable</span>
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </mat-form-field>
              <div [hidden]="serviceForm.get('timeslot').valid || (serviceForm.get('timeslot').pristine && !s_submitted )"
                class="text-danger">
                <small *ngIf="serviceForm.get('timeslot').hasError('required')" class="error-label">
                  {{getLang('timeslotisrequired', 'Time Slot is required !')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('charges', 'Charges')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width">
                <input matInput type="number" formControlName="cost">
              </mat-form-field>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('taxes', 'Taxes')}}
              </label>

              <mat-form-field class="example-full-width">
                <mat-select matNativeControl multiple formControlName="taxes">
                  <mat-option [value]="tax" *ngFor="let tax of selectedService?.taxes">
                    {{tax?.taxname}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('discount', 'Discount')}}
              </label>
              <mat-form-field class="example-full-width">
                <input matInput type="number" formControlName="discount">
              </mat-form-field>
              <div [hidden]="serviceForm.get('discount').valid || (serviceForm.get('discount').pristine)"
                class="text-danger">
                <small *ngIf="serviceForm.get('discount').hasError('insertonlypositivenumber')" class="error-label">
                  {{getLang('discountshouldbepositive ', 'Discount should be positive
                  !')}}
                </small>
              </div>
            </div>

            <div class="col-sm-6">
              <label class="col-form-label">
                {{getLang('status', 'Status')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width" appearance="standard">
                <mat-select placeholder="Choose option" formControlName="status" matNativeControl>
                  <mat-option [value]="status.code" *ngFor="let status of statusList">{{status.value}}</mat-option>
                </mat-select>
              </mat-form-field>
              <div [hidden]="serviceForm.get('status').valid || (serviceForm.get('status').pristine && !s_submitted)"
              class="text-danger">
              <small *ngIf="serviceForm.get('status').hasError('required')" class="error-label">
                {{getLang('statusrequired ', 'Status should be required
                !')}}
              </small>
            </div>
            </div>


            <ng-container *ngIf="appliedCouponsIn.includes('bill')" >
              <div class="col-sm-6">
                <label class="col-form-label">
                  {{getLang('couponcode', 'Coupon Code')}}
                </label>
                <mat-form-field class="example-full-width" appearance="standard">
                  <input type="text" matInput [matAutocomplete]="auto" placeholder="Enter Coupon"
                    (keyup)="enterCoupon($event)" [(ngModel)]="selectedCoupon"  formControlName="couponcode">
                  <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCn"  (optionSelected)='onCouponSelectForService($event.option.value)'>
                    <ng-container *ngIf="couponList.length > 0">
                      <mat-option *ngFor="let option of couponfilteredOptions | async" [value]="option">
                        {{option.couponcode}}
                      </mat-option>
                    </ng-container>
                    <ng-container *ngIf="couponList.length == 0">
                      <mat-option>
                        <span>{{getLang('norecord', 'No Record')}}</span>
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
               
              <div class="col-sm-6" *ngIf="serviceForm.get('coupondiscount').value">
                  <label class="col-form-label">
                    {{getLang('coupndiscount','Coupon discount')}}
                  </label>
                <mat-form-field class="example-full-width">  
                    <input type="number"  formControlName="coupondiscount" matInput >
                </mat-form-field>
              </div>
            </ng-container>


          </div>
        </div>
        <div class="modal-footer">
          <button type="button" [disabled]="disableBtn" data-dismiss="modal" (click)="closeService(selectedService)"
            class="btn btn-default">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}</button>
          <button type="submit" [disabled]="disableBtn" class="btn btn-primary ml-2">
            <i class="material-icons">save</i>
            {{getLang('save', 'Save')}}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>


<div id="giftcardmodal" data-toggle="modal" data-target="#giftcard" ></div>

<div class="modal fade" id="giftcard" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-scrollable">
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">  Git card of {{selectedItem?.itemname}}
              </h4>
              <button mat-button type="button" id="gcClose" class="close" data-dismiss="modal" aria-hidden="true">
                  <i class="material-icons">clear</i>
              </button>
          </div>
          <div class="modal-body">
              <div class="row"> 
                  <div class="col-md-12">
                      <label class="col-form-label">
                          {{getLang('giftcard','Gitcard')}}
                      </label>
                      <mat-form-field class="example-full-width">
                          <input type="text" matInput [(ngModel)]="selectedItem.itemnumber" >
                      </mat-form-field>
                  </div>

                  <div class="col-md-6">
                    <label class="col-form-label">
                      {{getLang('expires','Expires')}}
                      <span class="text-danger">*</span>
                    </label>
                    <mat-form-field class="example-full-width">
                      <input matInput [(ngModel)]="selectedItem.valid" [matDatepicker]="pickergcvd"
                          placeholder="Expires date">
                      <mat-datepicker-toggle matSuffix [for]="pickergcvd"></mat-datepicker-toggle>
                      <mat-datepicker #pickergcvd></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="col-md-6">
                    <label class="col-form-label">
                        {{getLang('qty','Quantity')}}
                    </label>
                    <mat-form-field class="example-full-width">
                        <input type="number" matInput [(ngModel)]="selectedItem.quantity" >
                    </mat-form-field>
                  </div>
                
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-default" type="button" data-dismiss="modal">
                  <i class="material-icons">close</i> {{getLang('cancel','Cancel')}}
              </button>
              <button class="btn btn-primary ml-2" type="button" (click)=onGiftCardAdd()>
                  <i class="material-icons">save</i> {{getLang('save','Save')}}
              </button>
          </div>
      </div>
  </div>
</div>





<div class="modal fade" id="couponModal" tabindex="-1">
  <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="ConfirmModalLabel"> {{getLang('srchcopn', 'Search coupon for ')}}  {{selectedItem?.itemname}}</h4> 
          <button type="button" id="closecn"   class="close" data-dismiss="modal"
            aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-12">
              <label class="col-form-label">
                {{getLang('couponcode', 'Coupon Code')}}
                <span class="text-danger">*</span>
              </label>
              <mat-form-field class="example-full-width" appearance="standard">
                <input type="text" matInput [matAutocomplete]="auto" placeholder="Enter Coupon"
                  (keyup)="enterCoupon($event)" [(ngModel)]="selectedCoupon">
                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCn"  (optionSelected)='onCouponSelect($event.option.value)'>
                  <ng-container *ngIf="couponList.length > 0">
                    <mat-option *ngFor="let option of couponfilteredOptions | async" [value]="option">
                      {{option.couponcode}}
                    </mat-option>
                  </ng-container>
                  <ng-container *ngIf="couponList.length == 0">
                    <mat-option>
                      <span>{{getLang('norecord', 'No Record')}}</span>
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </mat-form-field>
            </div>

            <div class="col-sm-12" *ngIf="selectedItem?.rate?.discount">
                <label class="col-form-label">
                  {{getLang('prddicnt','Product discount')}}
                </label>
              <mat-form-field class="example-full-width">  
                  <input type="number" matInput disabled [(ngModel)]="selectedItem.rate.discount" >
              </mat-form-field>
            </div>
             
            <div class="col-sm-12" *ngIf="selectedCoupon?.coupondiscount">
                <label class="col-form-label">
                  {{getLang('coupndiscount','Coupon discount')}}
                </label>
              <mat-form-field class="example-full-width">  
                  <input type="number" matInput disabled [(ngModel)]="selectedCoupon.coupondiscount" >
              </mat-form-field>
            </div>

          </div>
        </div>
        <div class="modal-footer">
          <button type="button" data-dismiss="modal" 
            class="btn btn-default" [disabled]="selectedCoupon?.disable">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}
          </button>
          <button type="button" (click)="applyCpn()" [disabled]="selectedCoupon?.disable" class="btn btn-primary ml-2">
            <i class="material-icons">redeem</i>
            {{getLang('aplyvpn', 'Apply Coupon')}}
          </button>
        </div>
      </div> 
  </div>
</div>




<div id="productModal" data-toggle="modal" data-target="#product"></div>
<div class="modal fade" id="product" tabindex="-1">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="ConfirmModalLabel"> {{getLang('prddetls', 'Product details ')}}</h4> 
          <button type="button" id="closecn"   class="close" data-dismiss="modal"
            aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div fxLayout="row" *ngIf="loadingprd" fxLayoutAlign="space-around center"
              style="height:100%; position: relative; margin-left: 50%; margin-right: 50%;">
              <mat-spinner diameter="50" strokeWidth="5"></mat-spinner>
            </div>
          <div class="table-responsive" *ngIf="!loadingprd" >
            <table class="table table-membroz table-pos">
              <thead>
                <tr>
                  <th>{{getLang('product', 'Product')}}</th>
                  <th class="text-center">{{getLang('rate', 'Rate')}}</th>
                  <th class="text-center">{{getLang('discount', 'Discount')}}</th>
                  <th class="text-right">{{getLang('qty', 'Qty')}}</th> 
                  <th class="text-right" >{{getLang('price', 'Price')}}</th>
                </tr>
              </thead>
              <tbody>
                <tr> 
                  <td>{{selectedItem?.itemname}} </td>
                  <td class="text-center text-nowrap">
                    {{selectedItem?.sale?.rate | myCurrencyPipe}}
                  </td>
                  <td class="text-center text-nowrap">
                    {{selectedItem?.discount ?  (selectedItem?.discount | myCurrencyPipe ) : ''}}
                  </td>
                  <td class="text-right text-nowrap">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove" style="width: 70px;">
                      <input type="number" matInput  [(ngModel)]="selectedItem.quantity" (input)="onstaticqty($event.target.value)" [disabled]="isPaymentMode" oninput="this.value = Math.abs(this.value)" style="text-align:right;">
                  </mat-form-field>
                </div>
                  </td>
                  <td class="text-right text-nowrap"> 
                    {{selectedItem?.totalcost | myCurrencyPipe}}
                   </td>
                </tr>

                <tr>
                  <td colspan="4"> 
                    <div class="form-inline">
                      <div class="mr-2">Sold by</div>
                      <app-dynamic-autocomplete-ngmodel *ngIf="provider_fields.visible" [(inputModel)]="provider_fields.modelValue" [setting]="provider_fields" [classes]="'inside-autocomplete-m-remove min-width-320'"
                      [dbvalue]="provider_fields.dbvalue" >
                    </app-dynamic-autocomplete-ngmodel>
                    </div> 
                   
                  </td>
                  
                  <td class="text-right">
                    <div>
                      <mat-form-field class="example-full-width mat-form-field-space-remove" appearance="standard">
                        <input type="text" matInput [matAutocomplete]="auto" placeholder="Enter Coupon"
                          (keyup)="enterCoupon($event)" [(ngModel)]="selectedCoupon" (change)="handleEmptyInput($event)" style="text-align: right;">
                        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCn"  (optionSelected)='onCouponSelect($event.option.value)'>
                          <ng-container *ngIf="couponList.length > 0">
                            <mat-option *ngFor="let option of couponfilteredOptions | async" [value]="option">
                              {{option.couponcode}}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="couponList.length == 0">
                            <mat-option>
                              <span>{{getLang('norecord', 'No Record')}}</span>
                            </mat-option>
                          </ng-container>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>
                  </td>
                </tr>

                <tr *ngIf="selectedCoupon && selectedCoupon.coupondiscount">
                  <td colspan="3"></td>
                  <td>Coupons discount </td>
                  <td class="text-right">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove">
                        <input type="number" matInput disabled [value]="selectedCoupon.coupondiscount" style="text-align: right;" >
                    </mat-form-field>
                  </div>
                  </td>
                </tr>
                <tr *ngIf="selectedCoupon && selectedCoupon.coupondiscount">
                  <td colspan="3"></td>
                  <td>Total </td>
                  <td class="text-right">
                    <div class="ml-auto col-md-8">
                    <mat-form-field class="example-full-width mat-form-field-space-remove">  
                        <input type="number" matInput disabled [value]="selectedCoupon.finaltotalcost" style="text-align: right;">
                    </mat-form-field>
                  </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" data-dismiss="modal" 
            class="btn btn-default" [disabled]="disableBtn">
            <i class="material-icons">close</i>
            {{getLang('cancel', 'Cancel')}}
          </button>
          <button type="button" (click)="onDonePrd()" [disabled]="disableBtn" class="btn btn-primary ml-2">
            <i class="material-icons">save</i>
            {{getLang('save', 'Save')}}
          </button>
        </div>
      </div> 
  </div>
</div>