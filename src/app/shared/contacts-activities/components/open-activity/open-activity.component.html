<div class="card mnh-230 mt-0">
    <div class="card-header card-head-membroz d-flex">
        <span class="flex-grow-1">{{getLang('openactivity', 'Open Activity')}}</span>
        <span>
            <a id="openActivity" data-toggle="modal" data-target="#myModalOpenActivity" (click)="loadDisposition()"
                class="cursor-pointer">
                <img src="../assets/img/plus-white-icon.svg" class="ml-2" alt="">
            </a>
        </span>
    </div>
    <div class="card-body p-0">
        <ul class="list-unstyled activity-item-list">

            <ng-container *ngIf="openActivitieLists && openActivitieLists.length > 0; else displayTemplate">
                <li *ngFor="let item of openActivitieLists.slice(0,2)">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="font-500">
                                {{item && item._id.dispositionid && item._id.dispositionid.disposition ? item._id.dispositionid.disposition : item && item.dispositionid && item.dispositionid.disposition ? item.dispositionid.disposition : '---'}}
                            </div>
                            <div class="font-13 item-light-gray-color">
                                {{item.duedate | date: 'shortTime'}} &nbsp;&nbsp;&nbsp;
                                {{item.duedate | date: 'mediumDate'}}
                            </div>
                        </div>
                        <div class="ml-2">
                            <a (click)="closeActivity(item)" class="cursor-pointer">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25">
                                    <g transform="translate(-666 -678)">
                                        <g transform="translate(671 683)">
                                            <g transform="translate(0 0)">
                                                <path
                                                    d="M115.251,113.23l-2.356-2.343a1.371,1.371,0,0,0-1.939,0h0l-1.355,1.355a.3.3,0,0,1-.382.034,15.56,15.56,0,0,1-3.635-3.567.294.294,0,0,1,.029-.382L107,106.944a1.371,1.371,0,0,0,0-1.937l-2.356-2.356a1.4,1.4,0,0,0-1.941,0l-.746.746a4.192,4.192,0,0,0-1.04,4.277,12.575,12.575,0,0,0,1.535,3.111,16.307,16.307,0,0,0,4.708,4.624,12,12,0,0,0,3.488,1.552,4.038,4.038,0,0,0,.972.113,4.243,4.243,0,0,0,2.989-1.258l.641-.641a1.371,1.371,0,0,0,0-1.945Zm-.594,1.365h0v-.012l-.641.641a3.354,3.354,0,0,1-3.162.9,11.144,11.144,0,0,1-3.236-1.45,15.5,15.5,0,0,1-4.461-4.372,11.736,11.736,0,0,1-1.434-2.9,3.354,3.354,0,0,1,.838-3.425l.746-.746a.532.532,0,0,1,.753,0h0l2.356,2.356a.532.532,0,0,1,0,.753h0l-1.383,1.383a1.129,1.129,0,0,0-.113,1.468,16.516,16.516,0,0,0,3.84,3.765,1.136,1.136,0,0,0,1.45-.125l1.337-1.355a.532.532,0,0,1,.753,0h0l2.36,2.365a.532.532,0,0,1,0,.753Z"
                                                    transform="translate(-100.708 -102.262)"
                                                    class="svg-fill-stroke-secondary-icon" stroke-width="0.3" />
                                            </g>
                                        </g>
                                        <g transform="translate(666 678)" fill="none" class="svg-stroke-secondary-icon"
                                            stroke-width="1">
                                            <circle cx="12.5" cy="12.5" r="12.5" stroke="none" />
                                            <circle cx="12.5" cy="12.5" r="12" fill="none" />
                                        </g>
                                    </g>
                                </svg>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="text-center" *ngIf="openActivitieLists && openActivitieLists.length > 0"> <a (click)="viewmore()" class="cursor-pointer">{{getLang('viewmore', 'View More')}}</a></li>
            </ng-container>
            <ng-template #displayTemplate>
                <li>
                    <div class="d-flex align-items-center justify-content-center mt-5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="98.211" height="68.285" viewBox="0 0 98.211 68.285">
                        <g id="empty-state" transform="translate(-20767.001 -10703.957)">
                            <g id="box7" transform="translate(20791.715 11203.957)">
                            <path id="Path_887" data-name="Path 887" d="M8.952-495.168c-4.841,2.65-8.877,4.9-8.971,4.991a1.157,1.157,0,0,0-.225.562l-.056.393,2.678,2.688,2.687,2.687-2.631,2.631c-2.407,2.407-2.631,2.659-2.678,3a.659.659,0,0,0,.169.637,31.219,31.219,0,0,0,2.847,1.695l2.622,1.433.047,5.019.047,5.019.234.215c.131.131,4.167,2.378,8.961,5.019,6.087,3.334,8.821,4.785,9.018,4.785s2.931-1.451,9.018-4.785c4.794-2.641,8.83-4.888,8.961-5.019l.234-.215.047-5.019.047-5.019,2.622-1.433a31.394,31.394,0,0,0,2.837-1.686.81.81,0,0,0,.075-.964c-.075-.14-1.274-1.386-2.669-2.781l-2.538-2.528,2.678-2.687,2.687-2.687-.056-.393a1.157,1.157,0,0,0-.225-.562c-.318-.309-6.339-3.568-6.686-3.615a.645.645,0,0,0-.637.215.838.838,0,0,0-.169,1.217,22.263,22.263,0,0,0,2.725,1.629c1.367.749,2.491,1.377,2.491,1.4s-.964,1.011-2.144,2.191l-2.144,2.144-7.707-4.233c-4.242-2.332-7.744-4.27-7.782-4.307a26.112,26.112,0,0,1,2.079-2.21l2.163-2.154.581.318c4.392,2.425,4.336,2.4,4.851,1.892a.889.889,0,0,0,.047-1.255A55.061,55.061,0,0,0,29.4-500a.983.983,0,0,0-.459.15c-.131.084-1.358,1.274-2.734,2.65l-2.51,2.491L21.2-497.2c-1.386-1.376-2.613-2.566-2.744-2.65a.984.984,0,0,0-.468-.15C17.847-500,14.121-498.005,8.952-495.168Zm11.04-.534,2.135,2.135-.412.234c-.215.131-3.727,2.06-7.791,4.289L6.545-484.99l-2.172-2.182a26.236,26.236,0,0,1-2.069-2.21c.056-.028,3.53-1.938,7.725-4.251s7.679-4.2,7.725-4.2S18.812-496.882,19.992-495.7Zm11.415,7.65c4.176,2.3,7.613,4.186,7.632,4.2.047.037-15.217,8.381-15.338,8.381-.066,0-3.558-1.882-7.753-4.186l-7.622-4.186L8.643-484c.169-.094,3.6-1.985,7.613-4.2s7.36-4.027,7.426-4.027S27.221-490.346,31.407-488.052ZM14.336-478.4l7.791,4.27-2.144,2.144c-1.171,1.171-2.172,2.135-2.219,2.135-.075,0-14.982-8.147-15.413-8.428-.112-.075.3-.524,2.013-2.247,1.18-1.18,2.163-2.154,2.172-2.154S10.057-480.757,14.336-478.4Zm28.7-2.126c1.18,1.18,2.126,2.163,2.1,2.191-.094.094-15.282,8.418-15.432,8.456a15.459,15.459,0,0,1-2.285-2.107l-2.144-2.144,7.763-4.27c4.261-2.341,7.772-4.27,7.8-4.27S41.847-481.712,43.037-480.523ZM12.81-470.372c2.875,1.573,4.991,2.678,5.131,2.678a1.171,1.171,0,0,0,.449-.1c.112-.056,1.358-1.245,2.762-2.641l2.547-2.547,2.556,2.547c1.4,1.4,2.641,2.584,2.753,2.641a1.171,1.171,0,0,0,.449.1c.187,0,8.774-4.607,10.329-5.544l.3-.187v8.053l-7.65,4.2c-4.2,2.313-7.678,4.214-7.725,4.233s-.084-2.2-.094-4.935l-.028-4.972-.262-.253a.749.749,0,0,0-.627-.262.749.749,0,0,0-.627.262l-.262.253-.028,4.972c-.009,2.734-.056,4.954-.094,4.935s-3.521-1.92-7.725-4.233l-7.65-4.2v-8.053l.309.187C7.781-473.135,10.122-471.852,12.81-470.372Z" fill="#f57c00"/>
                            <path id="Path_888" data-name="Path 888" d="M246.975-184.806a1.055,1.055,0,0,0-.189,1.678,1.023,1.023,0,0,0,1.678-.6A1.04,1.04,0,0,0,246.975-184.806Z" transform="translate(-223.758 -285.731)" fill="#f57c00"/>
                            <path id="Path_889" data-name="Path 889" d="M395.566-451.687a1.023,1.023,0,0,0-.566.986,1.115,1.115,0,0,0,1,.944,1.213,1.213,0,0,0,1.038-.787,1.084,1.084,0,0,0-.608-1.154C395.976-451.886,395.965-451.886,395.566-451.687Z" transform="translate(-358.461 -43.11)" fill="#f57c00"/>
                            </g>
                            <g id="Polygon_1" data-name="Polygon 1" transform="translate(20767 10725)" fill="none">
                            <path d="M5,0l5,8.75H0Z" stroke="none"/>
                            <path d="M 5 2.015560150146484 L 1.723176956176758 7.75 L 8.276823043823242 7.75 L 5 2.015560150146484 M 5 0 L 10 8.75 L 0 8.75 L 5 0 Z" stroke="none" fill="#ff4e20"/>
                            </g>
                            <g id="Polygon_2" data-name="Polygon 2" transform="translate(20838 10749)" fill="#fff">
                            <path d="M 9.097874641418457 7.5 L 0.9021250009536743 7.5 L 5 0.9434000253677368 L 9.097874641418457 7.5 Z" stroke="none"/>
                            <path d="M 5 1.886799812316895 L 1.80424976348877 7 L 8.19575023651123 7 L 5 1.886799812316895 M 5 0 L 10 8 L 0 8 L 5 0 Z" stroke="none" fill="#6b70ff"/>
                            </g>
                            <g id="Ellipse_87" data-name="Ellipse 87" transform="translate(20783 10750)" fill="#fff" stroke="#2ac5d1" stroke-width="1">
                            <circle cx="4" cy="4" r="4" stroke="none"/>
                            <circle cx="4" cy="4" r="3.5" fill="none"/>
                            </g>
                            <g id="Rectangle_834" data-name="Rectangle 834" transform="translate(20814 10762.343) rotate(45)" fill="#fff" stroke="#de43de" stroke-width="1">
                            <rect width="7" height="7" stroke="none"/>
                            <rect x="0.5" y="0.5" width="6" height="6" fill="none"/>
                            </g>
                            <path id="star" d="M7.818,9.554a.44.44,0,0,1-.24-.071L5,7.81,2.422,9.483a.441.441,0,0,1-.664-.489l.807-2.865L.156,4.089a.441.441,0,0,1,.253-.776L3.3,3.106,4.6.258a.44.44,0,0,1,.8,0L6.7,3.106l2.89.208a.441.441,0,0,1,.253.776L7.434,6.128l.807,2.865a.441.441,0,0,1-.424.56ZM5,6.845a.44.44,0,0,1,.24.071L7.076,8.107,6.509,6.095a.44.44,0,0,1,.139-.456l1.8-1.524L6.377,3.966a.441.441,0,0,1-.369-.256L5,1.5,3.992,3.709a.44.44,0,0,1-.369.256L1.55,4.115l1.8,1.524a.441.441,0,0,1,.139.456L2.923,8.107,4.76,6.916A.44.44,0,0,1,5,6.845Z" transform="translate(20855.213 10729)" fill="#00cb5f"/>
                        </g>
                        </svg>
                    </div>
                </li>
            </ng-template>
            
        </ul>
    </div>
</div>

<!-- Trigger the modal with a button -->
<button type="button" class="btn btn-info btn-lg d-none">{{getLang('openmodal', 'Open Modal')}}</button>

<div id="myModalOpenActivity" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" *ngIf="formVisible">            
            <form  [formGroup]="form"  (ngSubmit)="onSubmit(form.value, form.valid)"  novalidate  class="mb-0">
                <div class="modal-header">
                    <h4 class="modal-title">{{getLang('openactivity', 'Open Activity')}}</h4>
                    <button type="button" class="close" data-dismiss="modal" id="close" (click)="advcQtyClose()"><span
                            aria-hidden="true" >&times;</span></button>
                </div>
                <div class="modal-body mat-tree-node-auto">
                    
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="col-form-label">
                                {{getLang('disposition', 'Activity')}} 
                            </label>

                            <div>
                                <mat-radio-group
                                    aria-labelledby="example-radio-group-label"
                                    class="example-radio-group"
                                    name="disposition"
                                    formControlName="disposition">
                                    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">

                                        <mat-tree-node 
                                            *matTreeNodeDef="let node" 
                                            matTreeNodeToggle>
                                            <li 
                                                class="mat-tree-node">
                                                <button 
                                                    mat-icon-button 
                                                    disabled>
                                                </button>
                                                <mat-radio-button 
                                                    [value]="node._id"
                                                    [disabled]="node.action == ''">
                                                    {{node.disposition}} 
                                                </mat-radio-button>
                                            </li>
                                        </mat-tree-node>

                                        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                                            <li>
                                                <div class="mat-tree-node">
                                                    <button 
                                                        mat-icon-button 
                                                        matTreeNodeToggle
                                                        [attr.aria-label]="'toggle ' + node.disposition">
                                                        <mat-icon 
                                                            class="mat-icon-rtl-mirror">
                                                            {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                                                        </mat-icon>
                                                    </button>
                                                    <mat-radio-button 
                                                        [disabled]="node.action == ''"
                                                        [value]="node._id">
                                                        {{node.disposition}} 
                                                    </mat-radio-button>
                                                </div>
                                                <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
                                                    <ng-container matTreeNodeOutlet></ng-container>
                                                </ul>
                                            </li>
                                        </mat-nested-tree-node>
                                    </mat-tree>
                                </mat-radio-group>


                                <div [hidden]="form.get('disposition').valid || (form.get('disposition').pristine && !submitted)"
                                    class="text-danger">
                                    <small *ngIf="form.get('disposition').hasError('required')"
                                        class="error-label">
                                        {{getLang('dispositionisrequired', 'Disposition is Required')}}
                                    </small>
                                </div>

                                <!-- <div>Your favorite season is: {{this.form.get('disposition').value}}</div> -->

                                <ul class="list-unstyled">
                                    <li *ngIf="dataSource && dataSource.data && dataSource.data.length == 0">
                                        <a>Your disposition setup is incomplete. 
                                            <button 
                                                class="btn btn-primary" 
                                                [routerLink]="['/pages/disposition-module/form']"> 
                                                click to setup disposition.
                                            </button> 
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                         <div class="col-sm-6">
                            <label class="col-form-label">
                                {{getLang('scheduledate', 'Due Date')}} 
                                <span class="text-danger">*</span>
                            </label>
                            <div>

                                <mat-form-field>
                                    <input 
                                        matInput 
                                        [ngxMatDatetimePicker]="picker" 
                                        [formControl]="scheduledate">
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <ngx-mat-datetime-picker 
                                        #picker 
                                        [showSpinners]="true"
                                        >
                                    </ngx-mat-datetime-picker>
                                  </mat-form-field>

                                <div [hidden]="form.get('scheduledate').valid || (form.get('scheduledate').pristine && !submitted)"
                                    class="text-danger">
                                    <small *ngIf="form.get('scheduledate').hasError('required')"
                                        class="error-label">
                                        {{getLang('scheduledateisrequired', 'Due is Required')}}
                                    </small>
                                </div>


                            </div>
                        </div>

                        <div class="col-sm-6">
                            <label class="col-form-label">
                                {{getLang('assingeeuser', 'Assign To')}}
                                <span class="text-danger">*</span>
                            </label>
                            <div>

                                <dynamic-autocomplete
                                    *ngIf="fields.visible"
                                    [formControlName]="fields.fieldname"
                                    [setting]="fields">
                                </dynamic-autocomplete>


                                <div
                                    [hidden]="form.get('assingeeuser').valid || (form.get('assingeeuser').pristine && !submitted)"
                                    class="text-danger">
                                    <small *ngIf="form.get('assingeeuser').hasError('required')" class="error-label">
                                        {{getLang('assingeeuserisrequired', 'Assingee is Required')}}
                                    </small>
                                </div>

                            </div>
                        </div>
                   </div>
                
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" data-dismiss="modal">
                        <i class="material-icons">close</i> {{getLang('cancel', 'Cancel')}}
                    </button>
                    <button class="btn btn-primary ml-2" type="submit">
                        <i class="material-icons">save</i> {{getLang('save', 'Save')}}
                    </button>

                </div>
            </form>
        </div>
    </div>
</div>

<button type="button" id="closeActivityPopup" class="btn btn-info btn-lg d-none" data-toggle="modal"
    data-target="#myModalCloseActivity">{{getLang('openmodal', 'Open Modal')}}</button>

<div id="myModalCloseActivity" class="modal fade" role="dialog" mat-dialog-title cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">

                <h4 class="modal-title">{{getLang('closeactivity', 'Close Activity')}}</h4>
                <button type="button" class="close" id="closeactivitybtn" data-dismiss="modal"><span
                    aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">

                <div class="row">

                    <div class="col-sm-6">
                        <label class="col-form-label">
                            {{getLang('disposition', 'Activity')}}
                        </label>
                        <mat-form-field class="example-full-width" [hidden]="true">
                            <input 
                                matInput 
                                type="text" 
                                class="example-margin" 
                                readonly
                                [value]="closeActivityModel?.dispositionName">
                        </mat-form-field>
                    </div>

                    <div class="col-sm-12">
                        <app-dynamic-dispositionform
                            *ngIf="closeActivityVisibility"
                            type="closeactivity"
                            [isfollowup]=false
                            [fields]="closeActivityModel?.customFields"
                            (onAddUpdateHistoryData)="getSubmittedData($event)">
                        </app-dynamic-dispositionform>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
